<!doctype html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Android,NDK,Android Gradle Plugin,"><link rel="alternate" href="/atom.xml" title="区长" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="&amp;#x5728;Android Studio 2.2&amp;#x5F00;&amp;#x59CB;&amp;#x7684;Android Gradle Plugin&amp;#x7248;&amp;#x672C;&amp;#x4E2D;&amp;#xFF0C;Google&amp;#x96C6;&amp;#x6210;&amp;#x4E86;&amp;#x5BF9;cmake&amp;#x7684;&amp;#x5B8C;&amp;#x7F8E;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x800"><meta name="keywords" content="Android,NDK,Android Gradle Plugin"><meta property="og:type" content="article"><meta property="og:title" content="Android Gradle Plugin 源码解析之 externalNativeBuild"><meta property="og:url" content="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/index.html"><meta property="og:site_name" content="区长"><meta property="og:description" content="&amp;#x5728;Android Studio 2.2&amp;#x5F00;&amp;#x59CB;&amp;#x7684;Android Gradle Plugin&amp;#x7248;&amp;#x672C;&amp;#x4E2D;&amp;#xFF0C;Google&amp;#x96C6;&amp;#x6210;&amp;#x4E86;&amp;#x5BF9;cmake&amp;#x7684;&amp;#x5B8C;&amp;#x7F8E;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x800"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/extern-build-cmake.png"><meta property="og:image" content="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/extern-build-ndk.png"><meta property="og:updated_time" content="2018-10-04T12:50:16.101Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Android Gradle Plugin 源码解析之 externalNativeBuild"><meta name="twitter:description" content="&amp;#x5728;Android Studio 2.2&amp;#x5F00;&amp;#x59CB;&amp;#x7684;Android Gradle Plugin&amp;#x7248;&amp;#x672C;&amp;#x4E2D;&amp;#xFF0C;Google&amp;#x96C6;&amp;#x6210;&amp;#x4E86;&amp;#x5BF9;cmake&amp;#x7684;&amp;#x5B8C;&amp;#x7F8E;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x800"><meta name="twitter:image" content="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/extern-build-cmake.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/"><title>Android Gradle Plugin 源码解析之 externalNativeBuild | 区长</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b5e95713d9398479a8df5c83e0159382";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">区长</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">业精于勤,荒于嬉; 行成于思,毁于随</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://fucknmb.com/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="区长"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="区长"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="区长" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Android Gradle Plugin 源码解析之 externalNativeBuild</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-24T19:42:31+08:00">2017-06-24 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/" itemprop="commentCount"></span> </a></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>&#x5728;Android Studio 2.2&#x5F00;&#x59CB;&#x7684;Android Gradle Plugin&#x7248;&#x672C;&#x4E2D;&#xFF0C;Google&#x96C6;&#x6210;&#x4E86;&#x5BF9;cmake&#x7684;&#x5B8C;&#x7F8E;&#x652F;&#x6301;&#xFF0C;&#x800C;&#x539F;&#x5148;&#x7684;ndkBuild&#x7684;&#x65B9;&#x5F0F;&#x652F;&#x6301;&#x4E5F;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x826F;&#x597D;&#x3002;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C31;&#x6765;&#x8BF4;&#x8BF4;Android Gradle Plugin&#x4E0E;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x4E4B;&#x95F4;&#x7684;&#x4E00;&#x4E9B;&#x4E8B;&#xFF0C;&#x5373;externalNativeBuild&#x76F8;&#x5173;&#x7684;task&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x89E3;&#x8BFB;&#x4E00;&#x4E0B;gradle&#x6784;&#x5EFA;&#x7CFB;&#x7EDF;&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x3002;</p><a id="more"></a><h3 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h3><p>&#x5982;&#x679C;&#x4F60;&#x5728;gradle&#x4E2D;&#x4F7F;&#x7528;&#x8FC7;cmake&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5728;gradle&#x6267;&#x884C;sync&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x9879;&#x76EE;&#x7684;module&#x76EE;&#x5F55;&#x4E0B;&#x5C31;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x53EB;<strong>.externalNativeBuild</strong>&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x7528;&#x6765;&#x8FDB;&#x884C;C/C++&#x4EE3;&#x7801;&#x7684;&#x7F16;&#x8BD1;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7528;&#x7684;&#x662F;ndkBuild&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x6587;&#x4EF6;&#x8F83;cmake&#x4F1A;&#x5C11;&#x5F88;&#x591A;&#x3002;</p><p>cmake&#x65B9;&#x5F0F;&#x4EA7;&#x751F;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x5982;&#x4E0B;&#xFF1A;</p><p><img src="/2017/06/24/Android-Gradle-Plugin&#x6E90;&#x7801;&#x89E3;&#x6790;&#x4E4B;externalNativeBuild/extern-build-cmake.png" alt="extern-build-cmake.png"></p><p>&#x800C;ndkBuild&#x65B9;&#x5F0F;&#x4EA7;&#x751F;&#x7684;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x5982;&#x4E0B;&#xFF1A;</p><p><img src="/2017/06/24/Android-Gradle-Plugin&#x6E90;&#x7801;&#x89E3;&#x6790;&#x4E4B;externalNativeBuild/extern-build-ndk.png" alt="extern-build-ndk.png"></p><p>&#x4ED6;&#x4EEC;&#x7684;&#x5171;&#x540C;&#x70B9;&#x662F;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x53EB;<strong>android_gradle_build.json</strong>&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7528;&#x6765;&#x88AB;Android Gradle Plugin&#x4E2D;&#x7684;externalNativeBuild&#x4EFB;&#x52A1;&#x89E3;&#x6790;&#xFF0C;&#x5C06;&#x6784;&#x5EFA;&#x547D;&#x4EE4;&#x89E3;&#x6790;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x7F16;&#x8BD1;C/C++&#x4EE3;&#x7801;&#xFF0C;&#x6700;&#x540E;&#x4EA7;&#x751F;&#x76EE;&#x6807;so&#x6587;&#x4EF6;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;x_build_command.txt&#x548C;x_build_output.txt&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;x&#x8868;&#x793A;&#x6784;&#x5EFA;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;cmake&#x7684;&#x8BDD;x&#x5C31;&#x7B49;&#x4E8E;cmake&#xFF0C;&#x4F7F;&#x7528;ndkBuild&#x7684;&#x8BDD;x&#x5C31;&#x7B49;&#x4E8E;ndkBuild&#x3002;x_build_command.txt&#x6587;&#x4EF6;&#x627F;&#x8F7D;&#x7740;&#x6784;&#x5EFA;&#x547D;&#x4EE4;&#xFF0C;android_gradle_build.json&#x7684;&#x751F;&#x6210;&#x4F9D;&#x8D56;&#x5B83;&#xFF0C;&#x800C;x_build_output.txt&#x6587;&#x4EF6;&#x662F;&#x6267;&#x884C;x_build_command.txt&#x4E2D;&#x7684;&#x6784;&#x5EFA;&#x547D;&#x4EE4;&#x540E;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><h3 id="cmake"><a href="#cmake" class="headerlink" title="cmake"></a>cmake</h3><p>&#x901A;&#x8FC7;&#x67E5;&#x770B;android gradle plugin&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x751F;&#x6210;cmake_build_command.txt&#x6587;&#x4EF6;&#x751F;&#x6210;&#x7684;&#x65B9;&#x5F0F;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x65AD;&#x62FC;&#x63A5;&#x53C2;&#x6570;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5176;&#x6E90;&#x7801;&#x5728;CmakeExternalNativeJsonGenerator&#x4E2D;&#x7684;getProcessBuilder&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">@NonNull</span></span><br><span class="line"><span class="comment">@</span>Override</span><br><span class="line">ProcessInfoBuilder getProcessBuilder(<span class="comment">@NonNull String abi, int abiPlatformVersion,</span></span><br><span class="line"><span class="comment">        @</span>NonNull File outputJson) {</span><br><span class="line">    checkConfiguration();</span><br><span class="line">    ProcessInfoBuilder builder = <span class="keyword">new</span> ProcessInfoBuilder();</span><br><span class="line">    <span class="comment">// CMake requires a folder. Trim the filename off.</span></span><br><span class="line">    File cmakeListsFolder = getMakefile().getParentFile();</span><br><span class="line"></span><br><span class="line">    builder.setExecutable(getCmakeExecutable());</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-H%s&quot;</span>, cmakeListsFolder));</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-B%s&quot;</span>, outputJson.getParentFile()));</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> possibly remove the Android Gradle part.</span></span><br><span class="line">    <span class="comment">// Depends on how upstream CMake accepts our JSON patch.</span></span><br><span class="line">    builder.addArgs(<span class="string">&quot;-GAndroid Gradle - Ninja&quot;</span>);</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DANDROID_ABI=%s&quot;</span>, abi));</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DANDROID_NDK=%s&quot;</span>, getNdkFolder()));</span><br><span class="line">    builder.addArgs(</span><br><span class="line">            <span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_LIBRARY_OUTPUT_DIRECTORY=%s&quot;</span>,</span><br><span class="line">                    <span class="keyword">new</span> File(getObjFolder(), abi)));</span><br><span class="line">    builder.addArgs(</span><br><span class="line">            <span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_BUILD_TYPE=%s&quot;</span>, isDebuggable() ? <span class="string">&quot;Debug&quot;</span> : <span class="string">&quot;Release&quot;</span>));</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_MAKE_PROGRAM=%s&quot;</span>,</span><br><span class="line">            getNinjaExecutable().getAbsolutePath()));</span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_TOOLCHAIN_FILE=%s&quot;</span>,</span><br><span class="line">            getToolChainFile().getAbsolutePath()));</span><br><span class="line"></span><br><span class="line">    builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DANDROID_PLATFORM=android-%s&quot;</span>, abiPlatformVersion));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!getcFlags().isEmpty()) {</span><br><span class="line">        builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_C_FLAGS=%s&quot;</span>, Joiner.on(<span class="string">&quot; &quot;</span>).join(getcFlags())));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!getCppFlags().isEmpty()) {</span><br><span class="line">        builder.addArgs(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">&quot;-DCMAKE_CXX_FLAGS=%s&quot;</span>,</span><br><span class="line">                Joiner.on(<span class="string">&quot; &quot;</span>).join(getCppFlags())));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> argument : getBuildArguments()) {</span><br><span class="line">        builder.addArgs(argument);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> builder;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;ProcessInfoBuilder&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x643A;&#x5E26;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x6267;&#x884C;&#x65F6;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4F20;&#x9012;&#x7ED9;project.exec&#x6267;&#x884C;&#x3002;</p><ul><li>&#x8BBE;&#x7F6E;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E3A;cmake&#xFF0C;&#x8C03;&#x7528;getCmakeExecutable&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;cmake&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x8C03;&#x7528;setExecutable&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x5B83;</li><li>&#x62FC;&#x63A5;-H&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;CMakeList.txt&#x6587;&#x4EF6;&#x6240;&#x5728;&#x76EE;&#x5F55;</li><li>&#x62FC;&#x63A5;-B&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;cmake&#x4EA7;&#x751F;&#x7684;&#x4E2D;&#x95F4;&#x4EA7;&#x7269;&#xFF0C;&#x4E00;&#x822C;&#x5C31;&#x662F;cmake_build_command.txt&#x6240;&#x5728;&#x76EE;&#x5F55;&#x7684;&#x7236;&#x76EE;&#x5F55;&#xFF0C;cmake&#x6784;&#x5EFA;&#x4EA7;&#x751F;&#x7684;&#x4E2D;&#x95F4;&#x4EA7;&#x7269;&#x5168;&#x90FD;&#x4F4D;&#x4E8E;&#x6B64;&#x76EE;&#x5F55;&#x3002;</li><li>&#x62FC;&#x63A5;-G&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;Android Gradle - Ninja&#xFF0C;&#x544A;&#x8BC9;cmake&#x751F;&#x6210;Android Gradle&#x9700;&#x8981;&#x7684;&#x9879;&#x76EE;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x7528;ninja&#x6784;&#x5EFA;&#xFF0C;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8BE5;&#x503C;&#x5728;&#x6807;&#x51C6;&#x7684;cmake&#x4E2D;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;as&#x4F7F;&#x7528;&#x7684;cmake&#x662F;google&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#xFF0C;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x5176;&#x6CE8;&#x91CA; <strong>possibly remove the Android Gradle part. Depends on how upstream CMake accepts our JSON patch.</strong> &#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;google&#x53EF;&#x80FD;&#x4F1A;&#x79FB;&#x9664;&#x8BE5;&#x503C;&#x4E2D;Android Gradle&#x90E8;&#x5206;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x8981;&#x53D6;&#x51B3;&#x4E8E;cmake&#x5982;&#x679C;&#x63A5;&#x53D7;google&#x7684;patch&#x3002;</li><li>&#x8BBE;&#x7F6E;ANDROID_ABI&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;armeabi&#xFF0C;armeabi-v7a&#xFF0C;arm64-v8a&#xFF0C;x86&#xFF0C;x86_64&#xFF0C;mips&#xFF0C;mips64&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</li><li>&#x8BBE;&#x7F6E;ANDROID_NDK&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;ndk&#x7684;&#x8DEF;&#x5F84;&#x3002;</li><li>&#x8BBE;&#x7F6E;CMAKE_LIBRARY_OUTPUT_DIRECTORY&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;so&#x7684;&#x8F93;&#x51FA;&#x8DEF;&#x5F84;&#xFF0C;&#x4E00;&#x822C;&#x5176;&#x503C;&#x4E3A;&#x9879;&#x76EE;&#x7684;build&#x8DEF;&#x5F84;&#x4E0B;&#x7684;intermediates/cmake/debug/obj/$ANDROID_ABI</li><li>&#x8BBE;&#x7F6E;CMAKE_BUILD_TYPE&#x53C2;&#x6570;&#xFF0C;&#x662F;&#x5426;&#x662F;debug&#xFF0C;&#x5176;&#x503C;&#x4E3A;Debug&#x6216;&#x8005;Release&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#xFF0C;debug&#x542B;&#x7B26;&#x53F7;&#x4FE1;&#x606F;&#xFF0C;so&#x5F88;&#x5927;&#xFF0C;&#x4FBF;&#x4E8E;&#x8C03;&#x8BD5;&#xFF0C;Release&#x79FB;&#x9664;&#x4E86;debug&#x4FE1;&#x606F;&#xFF0C;&#x5C0F;&#x5F88;&#x591A;&#x3002;&#x5176;&#x503C;&#x6765;&#x6E90;&#x4E8E;build.gradle&#x4E2D;&#x7684;debuggable&#x503C;&#x3002;</li><li>&#x8BBE;&#x7F6E;CMAKE_MAKE_PROGRAM&#x53C2;&#x6570;&#x3002;&#x5176;&#x503C;&#x4E3A;ninja&#x8DEF;&#x5F84;&#xFF0C;&#x56E0;&#x4E3A;&#x751F;&#x6210;&#x7684;&#x662F;ninja&#x6784;&#x5EFA;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5176;&#x8DEF;&#x5F84;&#x3002;&#x8BE5;&#x503C;gradle&#x4F1A;&#x6839;&#x636E;sdk&#x548C;ndk&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x81EA;&#x52A8;&#x63A8;&#x65AD;&#x51FA;&#x3002;</li><li>&#x8BBE;&#x7F6E;CMAKE_TOOLCHAIN_FILE&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x662F;cmake&#x7528;&#x4E8E;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#x5FC5;&#x8981;&#x53C2;&#x6570;&#xFF0C;&#x4E3B;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;&#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x9700;&#x8981;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5982;CC&#xFF0C;CXX&#xFF0C;AR&#xFF0C;AS&#xFF0C;CFLAGS&#xFF0C;CXXFLAGS&#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;<a href="/2017/06/22/NDK%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F/">NDK &#x4EA4;&#x53C9;&#x7F16;&#x8BD1;&#x5E38;&#x7528;&#x53D8;&#x91CF;</a>&#xFF0C;android.toolchain.cmake&#x6587;&#x4EF6;&#x7684;&#x4EE3;&#x7801;&#x5728;<a href="https://android.googlesource.com/platform/tools/cmake-utils/+/cmake-master-dev/android.toolchain.cmake" target="_blank" rel="noopener">android.toolchain.cmake</a>&#xFF0C;&#x517C;&#x5BB9;<a href="https://github.com/taka-no-me/android-cmake" target="_blank" rel="noopener">android-cmake</a>&#xFF0C;&#x8BE5;&#x503C;gradle&#x4F1A;&#x6839;&#x636E;sdk&#x548C;ndk&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x81EA;&#x52A8;&#x63A8;&#x65AD;&#x51FA;&#x3002;</li><li>&#x8BBE;&#x7F6E;ANDROID_PLATFORM&#x53C2;&#x6570;&#xFF0C;&#x4E00;&#x822C;&#x8BBE;&#x6210;&#x548C;&#x9879;&#x76EE;&#x7684;&#x6700;&#x5C0F;api&#x7248;&#x672C;&#x4E00;&#x6837;&#x5373;&#x53EF;&#xFF0C;gradle&#x4F1A;&#x901A;&#x8FC7;&#x5B83;&#x548C;minSdk&#x67E5;&#x627E;&#x51FA;&#x5408;&#x9002;&#x7684;&#x503C;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;CMAKE_C_FLAGS&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x7F16;&#x8BD1;C&#x65F6;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;CMAKE_CXX_FLAGS&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x7F16;&#x8BD1;C++&#x65F6;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;arguments&#xFF0C;&#x5176;&#x503C;&#x4E3A;gradle&#x4F20;&#x8FDB;&#x6765;&#x7684;arguments&#x53C2;&#x6570;&#x3002;</li></ul><p>&#x66F4;&#x591A;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#x89C1;<a href="https://developer.android.com/ndk/guides/cmake.html" target="_blank" rel="noopener">CMake</a></p><p>&#x7136;&#x540E;&#x5C06;&#x8BE5;&#x8FD4;&#x56DE;&#x503C;&#x8F6C;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x8F93;&#x51FA;&#x5230;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5373;cmake_build_command.txt</p><p>&#x5176;&#x5185;&#x5BB9;&#x5927;&#x81F4;&#x5982;&#x4E0B;:</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Executable : /Users/lizhangqu/AndroidSDK/cmake/3.6.3155560/bin/cmake</span><br><span class="line">arguments : </span><br><span class="line">-<span class="ruby">Hpath/to/CMakeFiles Parent Dir</span></span><br><span class="line"><span class="ruby">-Bpath/to/moduleDir/.externalNativeBuild/cmake/debug/armeabi-v7a</span></span><br><span class="line"><span class="ruby">-GAndroid Gradle - Ninja</span></span><br><span class="line"><span class="ruby">-DANDROID_ABI=armeabi-v7a</span></span><br><span class="line"><span class="ruby">-DANDROID_NDK=<span class="regexp">/Users/lizhangqu</span><span class="regexp">/AndroidNDK/android</span>-ndk-r14b</span></span><br><span class="line"><span class="ruby">-DCMAKE_LIBRARY_OUTPUT_DIRECTORY=path/to/moduleDir/build/intermediates/cmake/debug/obj/armeabi-v7a</span></span><br><span class="line"><span class="ruby">-DCMAKE_BUILD_TYPE=Debug</span></span><br><span class="line"><span class="ruby">-DCMAKE_MAKE_PROGRAM=<span class="regexp">/Users/lizhangqu</span><span class="regexp">/AndroidSDK/cmake</span><span class="regexp">/3.6.3155560/bin</span><span class="regexp">/ninja</span></span></span><br><span class="line"><span class="ruby">-DCMAKE_TOOLCHAIN_FILE=<span class="regexp">/Users/lizhangqu</span><span class="regexp">/AndroidNDK/android</span>-ndk-r14b/build/cmake/android.toolchain.cmake</span></span><br><span class="line"><span class="ruby">-DANDROID_PLATFORM=android-<span class="number">14</span></span></span><br><span class="line"><span class="ruby">-DCMAKE_C_FLAGS=-fpic -fexceptions -frtti</span></span><br><span class="line"><span class="ruby">-DCMAKE_CXX_FLAGS=-fpic -fexceptions -frtti</span></span><br><span class="line"><span class="ruby">-DANDROID_STL=c++_static</span></span><br><span class="line"><span class="ruby">jvmArgs <span class="symbol">:</span></span></span><br></pre></td></tr></table></figure><p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x7528;&#x4E4B;&#xFF0C;&#x751F;&#x6210;cmake&#x9879;&#x76EE;&#x7ED3;&#x6784;&#xFF0C;&#x5982;&#x4E0B;</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/Users/lizhangqu/AndroidSDK/cmake/3.6.3155560/bin/cmake \</span></span><br><span class="line">-<span class="ruby">H<span class="string">&quot;path/to/CMakeFiles Parent Dir&quot;</span> \</span></span><br><span class="line"><span class="ruby">-B<span class="string">&quot;path/to/moduleDir/.externalNativeBuild/cmake/debug/armeabi-v7a&quot;</span> \</span></span><br><span class="line"><span class="ruby">-G<span class="string">&quot;Android Gradle - Ninja&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DANDROID_ABI=<span class="string">&quot;armeabi-v7a&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DANDROID_NDK=<span class="string">&quot;/Users/lizhangqu/AndroidNDK/android-ndk-r14b&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_LIBRARY_OUTPUT_DIRECTORY=<span class="string">&quot;path/to/moduleDir/build/intermediates/cmake/debug/obj/armeabi-v7a&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_BUILD_TYPE=<span class="string">&quot;Debug&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_MAKE_PROGRAM=<span class="string">&quot;/Users/lizhangqu/AndroidSDK/cmake/3.6.3155560/bin/ninja&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_TOOLCHAIN_FILE=<span class="string">&quot;/Users/lizhangqu/AndroidNDK/android-ndk-r14b/build/cmake/android.toolchain.cmake&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DANDROID_PLATFORM=<span class="string">&quot;android-14&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_C_FLAGS=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DCMAKE_CXX_FLAGS=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span> \</span></span><br><span class="line"><span class="ruby">-DANDROID_STL=<span class="string">&quot;c++_static&quot;</span></span></span><br></pre></td></tr></table></figure><p>&#x5176;&#x5BF9;&#x5E94;&#x7684;gradle&#x8C03;&#x7528;&#x4EE3;&#x7801;&#x5927;&#x81F4;&#x5982;&#x4E0B;</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// See whether the current build command matches a previously written build command.</span></span><br><span class="line"><span class="keyword">String</span> currentBuildCommand = processBuilder.toString();</span><br><span class="line"><span class="keyword">boolean</span> rebuildDueToMissingPreviousCommand = false;</span><br><span class="line"><span class="built_in">File</span> commandFile = <span class="keyword">new</span> <span class="built_in">File</span>(expectedJson.getParentFile(),</span><br><span class="line">        <span class="keyword">String</span>.format(<span class="string">&quot;%s_build_command.txt&quot;</span>, getNativeBuildSystem().getName()));</span><br></pre></td></tr></table></figure><p>&#x5C31;&#x662F;&#x5C06;processBuilder&#x5BF9;&#x8C61;&#x4E2D;&#x643A;&#x5E26;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8C03;&#x7528;project.exec&#x6267;&#x884C;&#x5373;&#x53EF;&#x3002;</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">String</span> buildOutput = executeProcess(processBuilder);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write the captured process output to a file for diagnostic purposes.</span></span><br><span class="line"><span class="built_in">File</span> outputTextFile = <span class="keyword">new</span> <span class="built_in">File</span>(</span><br><span class="line">        expectedJson.getParentFile(),</span><br><span class="line">        <span class="keyword">String</span>.format(<span class="string">&quot;%s_build_output.txt&quot;</span>, getNativeBuildSystem().getName()));</span><br><span class="line">diagnostic(<span class="string">&quot;write build output %s&quot;</span>, outputTextFile.getAbsolutePath());</span><br><span class="line">Files.<span class="built_in">write</span>(buildOutput, outputTextFile, Charsets.UTF_8);</span><br></pre></td></tr></table></figure><p>executeProcess&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;cmake_build_output.txt&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5C31;&#x662F;&#x6267;&#x884C;cmake_build_command.txt&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x4E4B;&#x540E;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang</span></span><br><span class="line"><span class="ruby">-- Check <span class="keyword">for</span> working C <span class="symbol">compiler:</span> /Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang -- works</span></span><br><span class="line"><span class="ruby">-- Detecting C compiler ABI info</span></span><br><span class="line"><span class="ruby">-- Detecting C compiler ABI info - done</span></span><br><span class="line"><span class="ruby">-- Detecting C compile features</span></span><br><span class="line"><span class="ruby">-- Detecting C compile features - done</span></span><br><span class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang++</span></span><br><span class="line"><span class="ruby">-- Check <span class="keyword">for</span> working CXX <span class="symbol">compiler:</span> /Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang++ -- works</span></span><br><span class="line"><span class="ruby">-- Detecting CXX compiler ABI info</span></span><br><span class="line"><span class="ruby">-- Detecting CXX compiler ABI info - done</span></span><br><span class="line"><span class="ruby">-- Detecting CXX compile features</span></span><br><span class="line"><span class="ruby">-- Detecting CXX compile features - done</span></span><br><span class="line"><span class="ruby">-- Configuring done</span></span><br><span class="line"><span class="ruby">-- Generating done</span></span><br><span class="line"><span class="ruby">-- Build files have been written <span class="symbol">to:</span> path/to/moduleDir/.externalNativeBuild/cmake/debug/armeabi-v7a</span></span><br></pre></td></tr></table></figure><p>&#x6B64;&#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x6587;&#x4EF6;&#x4E5F;&#x88AB;&#x4E00;&#x5E76;&#x4EA7;&#x751F;&#xFF0C;&#x5982;android_gradle_build.json&#xFF0C;build.ninja&#xFF0C;cmake_insatll.cmake&#xFF0C;CMakeCache.txt&#xFF0C;rules.ninja&#xFF0C;CMakefiles&#x6587;&#x4EF6;&#x5939;&#x7B49;&#x7B49;&#x3002;</p><p>&#x800C;executeProcess&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x662F;GradleProcessExecutor&#x7684;execute&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5176;&#x5185;&#x90E8;&#x7C7B;ExecAction&#x7684;execute&#x65B9;&#x6CD5;&#x6784;&#x9020;ExecSpec&#x5BF9;&#x8C61;&#xFF0C;&#x8C03;&#x7528;project.exec&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x4E4B;&#x3002;&#x5176;&#x5927;&#x81F4;&#x6E90;&#x7801;&#x5982;&#x4E0B;:</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ProcessResult execute(</span><br><span class="line">        <span class="meta">@NonNull</span> ProcessInfo processInfo,</span><br><span class="line">        <span class="meta">@NonNull</span> ProcessOutputHandler processOutputHandler) {</span><br><span class="line">    ProcessOutput output = processOutputHandler.createOutput();</span><br><span class="line"></span><br><span class="line">    ExecResult result;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        result = project.exec(<span class="keyword">new</span> ExecAction(processInfo, output));</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            output.close();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            project.getLogger().warn(<span class="string">&quot;Exception while closing sub process streams&quot;</span>, e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        processOutputHandler.handleOutput(output);</span><br><span class="line">    } <span class="keyword">catch</span> (<span class="keyword">final</span> ProcessException e) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OutputHandlerFailedGradleProcessResult(e);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GradleProcessResult(result, processInfo);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecAction</span> <span class="keyword">implements</span> <span class="title">Action</span>&lt;<span class="title">ExecSpec</span>&gt; {</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProcessInfo processInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProcessOutput processOutput;</span><br><span class="line"></span><br><span class="line">    ExecAction(<span class="meta">@NonNull</span> <span class="keyword">final</span> ProcessInfo processInfo,</span><br><span class="line">            <span class="meta">@NonNull</span> <span class="keyword">final</span> ProcessOutput processOutput) {</span><br><span class="line">        <span class="keyword">this</span>.processInfo = processInfo;</span><br><span class="line">        <span class="keyword">this</span>.processOutput = processOutput;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> execute(ExecSpec execSpec) {</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Gradle doesn&apos;t work correctly when there are empty args.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;String&gt; args =</span><br><span class="line">                processInfo.getArgs().stream()</span><br><span class="line">                        .map(a -&gt; a.isEmpty()? &quot;\&quot;\&quot;&quot; : a)</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">        execSpec.setExecutable(processInfo.getExecutable());</span><br><span class="line">        execSpec.args(args);</span><br><span class="line">        execSpec.environment(processInfo.getEnvironment());</span><br><span class="line">        execSpec.setStandardOutput(processOutput.getStandardOutput());</span><br><span class="line">        execSpec.setErrorOutput(processOutput.getErrorOutput());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// we want the caller to be able to do its own thing.</span></span><br><span class="line">        execSpec.setIgnoreExitValue(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>json&#x6587;&#x4EF6;&#x751F;&#x6210;&#x4E86;&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x662F;&#x751F;&#x4EA7;so&#x6587;&#x4EF6;&#x4E86;&#xFF0C;&#x751F;&#x6210;so&#x6587;&#x4EF6;&#x7531;ExternalNativeBuildTask&#x8D1F;&#x8D23;&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x804C;&#x8D23;&#x5C31;&#x662F;&#x89E3;&#x6790;&#x51FA;android_gradle_build.json&#x6587;&#x4EF6;&#x4E2D;libraries&#x7684;&#x5404;&#x9879;&#x4E2D;&#x7684;&#x7684;artifactName&#x548C;buildCommand&#xFF0C;&#x4F20;&#x5165;&#x5BF9;&#x5E94;&#x7684;executeProcessBatch&#x51FD;&#x6570;&#xFF0C;&#x6267;&#x884C;buildCommand&#x4E2D;&#x7684;&#x503C;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x65B9;&#x5F0F;&#x4E5F;&#x662F;&#x901A;&#x8FC7;GradleProcessExecutor&#x7684;execute&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x4EA7;&#x751F;so&#x3002;</p><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;android_gradle_build.json&#x7684;&#x5927;&#x81F4;&#x5185;&#x5BB9;&#xFF1A;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">{</span><br><span class="line">	<span class="attr">&quot;buildFiles&quot;</span> : </span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;path/to/CMakeLists.txt&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;cleanCommands&quot;</span> : </span><br><span class="line">	[</span><br><span class="line">		<span class="string">&quot;/Users/lizhangqu/AndroidSDK/cmake/3.6.3155560/bin/cmake --build path/to/.externalNativeBuild/cmake/debug/armeabi-v7a --target clean&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">&quot;cppFileExtensions&quot;</span> : [<span class="string">&quot;cpp&quot;</span> ],</span><br><span class="line">	<span class="attr">&quot;libraries&quot;</span> : </span><br><span class="line">	{</span><br><span class="line">		<span class="attr">&quot;so&#x540D;&#x5B57;-Debug-armeabi-v7a&quot;</span> : </span><br><span class="line">		{</span><br><span class="line">			<span class="attr">&quot;abi&quot;</span> : <span class="string">&quot;armeabi-v7a&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;artifactName&quot;</span> : <span class="string">&quot;so&#x540D;&#x5B57;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;buildCommand&quot;</span> : <span class="string">&quot;/Users/lizhangqu/AndroidSDK/cmake/3.6.3155560/bin/cmake --build path/to/.externalNativeBuild/cmake/debug/armeabi-v7a --target so&#x540D;&#x5B57;&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;buildType&quot;</span> : <span class="string">&quot;debug&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;files&quot;</span> : </span><br><span class="line">			[</span><br><span class="line">				</span><br><span class="line">				{</span><br><span class="line">					<span class="attr">&quot;flags&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;src&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;workingDirectory&quot;</span> : <span class="string">&quot;path/to/.externalNativeBuild/cmake/debug/armeabi-v7a&quot;</span></span><br><span class="line">				},</span><br><span class="line">				{</span><br><span class="line">					<span class="attr">&quot;flags&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;src&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;workingDirectory&quot;</span> : <span class="string">&quot;path/to/.externalNativeBuild/cmake/debug/armeabi-v7a&quot;</span></span><br><span class="line">				},</span><br><span class="line">				{</span><br><span class="line">					<span class="attr">&quot;flags&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;src&quot;</span> : <span class="string">&quot;&#x5185;&#x5BB9;&quot;</span>,</span><br><span class="line">					<span class="attr">&quot;workingDirectory&quot;</span> : <span class="string">&quot;path/to/.externalNativeBuild/cmake/debug/armeabi-v7a&quot;</span></span><br><span class="line">				}</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">&quot;output&quot;</span> : <span class="string">&quot;path/to/build/intermediates/cmake/debug/obj/armeabi-v7a/so&#x540D;&#x5B57;.so&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;toolchain&quot;</span> : <span class="string">&quot;12644252315582812689&quot;</span></span><br><span class="line">		}</span><br><span class="line">	},</span><br><span class="line">	<span class="attr">&quot;toolchains&quot;</span> : </span><br><span class="line">	{</span><br><span class="line">		<span class="attr">&quot;12644252315582812689&quot;</span> : </span><br><span class="line">		{</span><br><span class="line">			<span class="attr">&quot;cCompilerExecutable&quot;</span> : <span class="string">&quot;/Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang&quot;</span>,</span><br><span class="line">			<span class="attr">&quot;cppCompilerExecutable&quot;</span> : <span class="string">&quot;/Users/lizhangqu/AndroidNDK/android-ndk-r14b/toolchains/llvm/prebuilt/darwin-x86_64/bin/clang++&quot;</span></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6CA1;&#x9519;&#x89E3;&#x6790;&#x7684;&#x5C31;&#x662F;libraries&#x4E0B;&#x201D;so&#x540D;&#x5B57;-Debug-armeabi-v7a&#x201D;&#x4E0B;&#x7684;artifactName&#x548C;buildCommand&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#x76F4;&#x63A5;&#x5C06;buildCommand&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x590D;&#x5236;&#x5230;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;so&#x5C31;&#x4F1A;&#x7F16;&#x8BD1;&#x4EA7;&#x751F;&#x3002;</p><p>&#x9664;&#x4E86;&#x76F4;&#x63A5;&#x590D;&#x5236;buildCommand&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x5230;cmake&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#xFF0C;&#x5373;-B&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x8C03;&#x7528;ninja&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x3002;&#x5982;&#xFF1A;</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/Users<span class="meta-keyword">/lizhangqu/</span>AndroidSDK<span class="meta-keyword">/cmake/</span><span class="number">3.6</span><span class="number">.3155560</span><span class="meta-keyword">/bin/</span>ninja clean</span><br><span class="line"></span><br><span class="line">/Users<span class="meta-keyword">/lizhangqu/</span>AndroidSDK<span class="meta-keyword">/cmake/</span><span class="number">3.6</span><span class="number">.3155560</span><span class="meta-keyword">/bin/</span>ninja</span><br></pre></td></tr></table></figure><p>ninja&#x662F;chromium&#x7684;&#x6838;&#x5FC3;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href="http://www.cnblogs.com/x_wukong/p/4846179.html" target="_blank" rel="noopener">Ninja - chromium&#x6838;&#x5FC3;&#x6784;&#x5EFA;&#x5DE5;&#x5177;</a>&#x5B66;&#x4E60;&#x4E0B;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x800C;clean&#x64CD;&#x4F5C;&#xFF0C;&#x5219;&#x7531;ExternalNativeCleanTask&#x8D1F;&#x8D23;&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x804C;&#x8D23;&#x5C31;&#x662F;&#x89E3;&#x6790;&#x51FA;android_gradle_build.json&#x4E2D;&#x7684;cleanCommands&#x547D;&#x4EE4;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x3002;</p><h3 id="ndkBuild"><a href="#ndkBuild" class="headerlink" title="ndkBuild"></a>ndkBuild</h3><p>&#x548C;cmake&#x7C7B;&#x4F3C;&#xFF0C;&#x9996;&#x5148;&#x5C31;&#x662F;ndkBuild_build_command.txt&#x7684;&#x751F;&#x6210;&#xFF0C;&#x5176;&#x751F;&#x6210;&#x6240;&#x9700;&#x7684;&#x5173;&#x952E;&#x53C2;&#x6570;&#x7531;NdkBuildExternalNativeJsonGenerator&#x4E2D;&#x7684;getProcessBuilder&#x51FD;&#x6570;&#x548C;getBaseArgs&#x51FD;&#x6570;&#x8D1F;&#x8D23;&#xFF0C;&#x5176;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">@NonNull</span><br><span class="line">@Override</span><br><span class="line">ProcessInfoBuilder getProcessBuilder(@NonNull <span class="keyword">String</span> abi, <span class="built_in">int</span> abiPlatformVersion,</span><br><span class="line">        @NonNull File outputJson) {</span><br><span class="line">    checkConfiguration();</span><br><span class="line">    <span class="comment">// Discover Application.mk if one exists next to Android.mk</span></span><br><span class="line">    <span class="comment">// If there is an Application.mk file next to Android.mk then pick it up.</span></span><br><span class="line">    File applicationMk = <span class="keyword">new</span> File(getMakeFile().getParent(), <span class="string">&quot;Application.mk&quot;</span>);</span><br><span class="line">    ProcessInfoBuilder builder = <span class="keyword">new</span> ProcessInfoBuilder();</span><br><span class="line">    builder.setExecutable(getNdkBuild())</span><br><span class="line">            .addArgs(getBaseArgs(abi, abiPlatformVersion, applicationMk))</span><br><span class="line">            <span class="comment">// Disable response files so we can parse the command line.</span></span><br><span class="line">            .addArgs(<span class="string">&quot;APP_SHORT_COMMANDS=false&quot;</span>)</span><br><span class="line">            .addArgs(<span class="string">&quot;LOCAL_SHORT_COMMANDS=false&quot;</span>)</span><br><span class="line">            .addArgs(<span class="string">&quot;-B&quot;</span>) <span class="comment">// Build as if clean</span></span><br><span class="line">            .addArgs(<span class="string">&quot;-n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> builder;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the base list of arguments for invoking ndk-build.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@NonNull</span><br><span class="line"><span class="keyword">private</span> List&lt;<span class="keyword">String</span>&gt; getBaseArgs(@NonNull <span class="keyword">String</span> abi, <span class="built_in">int</span> abiPlatformVersion,</span><br><span class="line">        @NonNull File applicationMk) {</span><br><span class="line">    List&lt;<span class="keyword">String</span>&gt; result = Lists.newArrayList();</span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;NDK_PROJECT_PATH=null&quot;</span>);</span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;APP_BUILD_SCRIPT=&quot;</span> + getMakeFile());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (applicationMk.exists()) {</span><br><span class="line">        <span class="comment">// NDK_APPLICATION_MK specifies the Application.mk file.</span></span><br><span class="line">        result.<span class="built_in">add</span>(<span class="string">&quot;NDK_APPLICATION_MK=&quot;</span> + applicationMk.getAbsolutePath());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// APP_ABI and NDK_ALL_ABIS work together. APP_ABI is the specific ABI for this build.</span></span><br><span class="line">    <span class="comment">// NDK_ALL_ABIS is the universe of all ABIs for this build. NDK_ALL_ABIS is set to just the</span></span><br><span class="line">    <span class="comment">// current ABI. If we don&apos;t do this, then ndk-build will erase build artifacts for all abis</span></span><br><span class="line">    <span class="comment">// aside from the current.</span></span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;APP_ABI=&quot;</span> + abi);</span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;NDK_ALL_ABIS=&quot;</span> + abi);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isDebuggable()) {</span><br><span class="line">        result.<span class="built_in">add</span>(<span class="string">&quot;NDK_DEBUG=1&quot;</span>);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        result.<span class="built_in">add</span>(<span class="string">&quot;NDK_DEBUG=0&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;APP_PLATFORM=android-&quot;</span> + abiPlatformVersion);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getObjFolder is set to the &quot;local&quot; subfolder in the user specified directory, therefore,</span></span><br><span class="line">    <span class="comment">// NDK_OUT should be set to getObjFolder().getParent() instead of getObjFolder().</span></span><br><span class="line">    <span class="keyword">String</span> ndkOut = getObjFolder().getParent();</span><br><span class="line">    <span class="keyword">if</span> (CURRENT_PLATFORM == PLATFORM_WINDOWS) {</span><br><span class="line">        <span class="comment">// Due to b.android.com/219225, NDK_OUT on Windows requires forward slashes.</span></span><br><span class="line">        <span class="comment">// ndk-build.cmd is supposed to escape the back-slashes but it doesn&apos;t happen.</span></span><br><span class="line">        <span class="comment">// Workaround here by replacing back slash with forward.</span></span><br><span class="line">        <span class="comment">// ndk-build will have a fix for this bug in r14 but this gradle fix will make it</span></span><br><span class="line">        <span class="comment">// work back to r13, r12, r11, and r10.</span></span><br><span class="line">        ndkOut = ndkOut.replace(<span class="string">&apos;\\&apos;</span>, <span class="string">&apos;/&apos;</span>);</span><br><span class="line">    }</span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;NDK_OUT=&quot;</span> + ndkOut);</span><br><span class="line"></span><br><span class="line">    result.<span class="built_in">add</span>(<span class="string">&quot;NDK_LIBS_OUT=&quot;</span> + getSoFolder().getAbsolutePath());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> flag : getcFlags()) {</span><br><span class="line">        result.<span class="built_in">add</span>(<span class="keyword">String</span>.format(<span class="string">&quot;APP_CFLAGS+=\&quot;%s\&quot;&quot;</span>, flag));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> flag : getCppFlags()) {</span><br><span class="line">        result.<span class="built_in">add</span>(<span class="keyword">String</span>.format(<span class="string">&quot;APP_CPPFLAGS+=\&quot;%s\&quot;&quot;</span>, flag));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> argument : getBuildArguments()) {</span><br><span class="line">        result.<span class="built_in">add</span>(argument);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li>&#x8BBE;&#x7F6E;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E3A;ndk-Build</li><li>&#x8BBE;&#x7F6E;NDK_PROJECT_PATH=null</li><li>&#x8BBE;&#x7F6E;APP_BUILD_SCRIPT&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x6307;&#x5411;Android.mk&#x6587;&#x4EF6;</li><li>&#x8BBE;&#x7F6E;NDK_APPLICATION_MK&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x6307;&#x5411;Application.mk&#x6587;&#x4EF6;&#xFF08;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x4E0D;&#x4F1A;&#x8BBE;&#x7F6E;&#x8BE5;&#x53C2;&#x6570;&#xFF09;</li><li>&#x8BBE;&#x7F6E;APP_ABI&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;armeabi&#xFF0C;armeabi-v7a&#xFF0C;arm64-v8a&#xFF0C;x86&#xFF0C;x86_64&#xFF0C;mips&#xFF0C;mips64&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</li><li>&#x8BBE;&#x7F6E;NDK_ALL_ABIS&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x7B49;&#x540C;&#x4E8E;APP_ABI</li><li>&#x8BBE;&#x7F6E;NDK_DEBUG&#x53C2;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x5341;&#x5206;&#x662F;debug&#x6784;&#x5EFA;&#xFF0C;debug&#x542B;&#x7B26;&#x53F7;&#x4FE1;&#x606F;&#xFF0C;so&#x5F88;&#x5927;&#xFF0C;&#x4FBF;&#x4E8E;&#x8C03;&#x8BD5;&#xFF0C;release&#x79FB;&#x9664;&#x4E86;debug&#x4FE1;&#x606F;&#xFF0C;&#x5C0F;&#x5F88;&#x591A;&#x3002;&#x5176;&#x503C;&#x6765;&#x6E90;&#x4E8E;build.gradle&#x4E2D;&#x7684;debuggable&#x503C;&#x3002;</li><li>&#x8BBE;&#x7F6E;APP_PLATFORM&#x53C2;&#x6570;&#xFF0C;&#x4E00;&#x822C;&#x8BBE;&#x6210;&#x548C;&#x9879;&#x76EE;&#x7684;&#x6700;&#x5C0F;api&#x7248;&#x672C;&#x4E00;&#x6837;&#x5373;&#x53EF;&#xFF0C;gradle&#x4F1A;&#x901A;&#x8FC7;&#x5B83;&#x548C;minSdk&#x67E5;&#x627E;&#x51FA;&#x5408;&#x9002;&#x7684;&#x503C;</li><li>&#x8BBE;&#x7F6E;NDK_OUT&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;obj&#x6587;&#x4EF6;&#x4EA7;&#x751F;&#x76EE;&#x5F55;&#xFF0C;&#x4E00;&#x822C;&#x6307;&#x5411;&#x9879;&#x76EE;&#x7684;build&#x8DEF;&#x5F84;&#x4E0B;&#x7684;intermediates/ndkBuild/$buildType/obj&#x76EE;&#x5F55;</li><li>&#x8BBE;&#x7F6E;NDK_LIBS_OUT&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x503C;&#x4E3A;libs&#x53C2;&#x6570;&#x76EE;&#x5F55;&#xFF0C;&#x7528;&#x4E8E;so&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x4E00;&#x822C;&#x6307;&#x5411;&#x9879;&#x76EE;&#x7684;build&#x8DEF;&#x5F84;&#x4E0B;&#x7684;intermediates/ndkBuild/$buildType/lib&#x76EE;&#x5F55;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;APP_CFLAGS&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x7F16;&#x8BD1;C&#x65F6;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;APP_CPPFLAGS&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#xFF0C;&#x5176;&#x503C;&#x4E3A;&#x7F16;&#x8BD1;C++&#x65F6;&#x7684;&#x4E00;&#x4E9B;&#x53C2;&#x6570;</li><li>&#x8BBE;&#x7F6E;&#x53EF;&#x9009;&#x9879;arguments&#xFF0C;&#x5176;&#x503C;&#x4E3A;gradle&#x4F20;&#x8FDB;&#x6765;&#x7684;arguments&#x53C2;&#x6570;&#x3002;</li><li>&#x8BBE;&#x7F6E;APP_SHORT_COMMANDS=false</li><li>&#x8BBE;&#x7F6E;LOCAL_SHORT_COMMANDS=false</li><li>&#x6DFB;&#x52A0;-B&#x53C2;&#x6570;</li><li>&#x6DFB;&#x52A0;-n&#x53C2;&#x6570;</li></ul><p>&#x6700;&#x7EC8;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x81F4;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Executable : /Users/lizhangqu/AndroidSDK/ndk-bundle/ndk-build</span><br><span class="line">arguments : </span><br><span class="line">NDK_PROJECT_PATH=null</span><br><span class="line">APP_BUILD_SCRIPT=path/to/Android.mk</span><br><span class="line">NDK_APPLICATION_MK=path/to/Application.mk</span><br><span class="line">APP_ABI=armeabi</span><br><span class="line">NDK_ALL_ABIS=armeabi</span><br><span class="line">NDK_DEBUG=1</span><br><span class="line">APP_PLATFORM=android-14</span><br><span class="line">NDK_OUT=path/to/moduleDir/build/intermediates/ndkBuild/debug/obj</span><br><span class="line">NDK_LIBS_OUT=path/to/moduleDir/build/intermediates/ndkBuild/debug/lib</span><br><span class="line">APP_CFLAGS+=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span></span><br><span class="line">APP_CPPFLAGS+=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span></span><br><span class="line">APP_SHORT_COMMANDS=false</span><br><span class="line">LOCAL_SHORT_COMMANDS=false</span><br><span class="line">-B</span><br><span class="line">-n</span><br><span class="line">jvmArgs :</span><br></pre></td></tr></table></figure><p>&#x540C;&#x7406;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x8C03;&#x7528;&#x4ED6;&#x4EEC;&#x6267;&#x884C;</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/Users/lizhangqu/AndroidSDK/ndk-bundle/ndk-build \</span><br><span class="line">NDK_PROJECT_PATH=null \</span><br><span class="line">APP_BUILD_SCRIPT=path/to/Android.mk \</span><br><span class="line">NDK_APPLICATION_MK=path/to/Application.mk \</span><br><span class="line">APP_ABI=armeabi \</span><br><span class="line">NDK_ALL_ABIS=armeabi \</span><br><span class="line">NDK_DEBUG=1 \</span><br><span class="line">APP_PLATFORM=android-14 \</span><br><span class="line">NDK_OUT=path/to/moduleDir/build/intermediates/ndkBuild/debug/obj \</span><br><span class="line">NDK_LIBS_OUT=path/to/moduleDir/build/intermediates/ndkBuild/debug/lib \</span><br><span class="line">APP_CFLAGS+=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span> \</span><br><span class="line">APP_CPPFLAGS+=<span class="string">&quot;-fpic -fexceptions -frtti&quot;</span> \</span><br><span class="line">APP_SHORT_COMMANDS=false \</span><br><span class="line">LOCAL_SHORT_COMMANDS=false \</span><br><span class="line">-B \</span><br><span class="line">-n \</span><br></pre></td></tr></table></figure><p>&#x5176;&#x4EE3;&#x7801;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x540C;cmake&#xFF0C;&#x6700;&#x7EC8;&#x751F;&#x6210;ndkBuild_build_output.txt&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x8C03;&#x7528;ndkBuild_build_command.txt&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x540E;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x800C;&#x540C;cmake&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;android_gradle_build.json&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4E0D;&#x518D;&#x662F;&#x7531;cmake&#x6784;&#x5EFA;&#x7CFB;&#x7EDF;&#x4EA7;&#x751F;&#xFF0C;&#x800C;&#x662F;gradle&#x89E3;&#x6790;ndkBuild_build_command.txt&#x4EA7;&#x751F;&#x7684;&#x3002;</p><p>&#x5176;&#x4EE3;&#x7801;&#x5927;&#x81F4;&#x5982;&#x4E0B;</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">NativeBuildConfigValue buildConfig = <span class="keyword">new</span> NativeBuildConfigValueBuilder(</span><br><span class="line">            getMakeFile(),</span><br><span class="line">            projectDir)</span><br><span class="line">        .addCommands(</span><br><span class="line">                getBuildCommand(abi, abiPlatformVersion, applicationMk),</span><br><span class="line">                variantName,</span><br><span class="line">                buildOutput,</span><br><span class="line">                isWindows())</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="built_in">if</span> (applicationMk.<span class="built_in">exists</span>()) {</span><br><span class="line">    diagnostic(<span class="string">&quot;found application make file %s&quot;</span>, applicationMk.getAbsolutePath());</span><br><span class="line">    Preconditions.checkNotNull(buildConfig.buildFiles);</span><br><span class="line">    buildConfig.buildFiles.add(applicationMk);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">String</span> actualResult = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">        .registerTypeAdapter(<span class="built_in">File</span>.class, <span class="keyword">new</span> PlainFileGsonTypeAdaptor())</span><br><span class="line">        .setPrettyPrinting()</span><br><span class="line">        .create()</span><br><span class="line">        .toJson(buildConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write the captured ndk-build output to JSON file</span></span><br><span class="line"><span class="built_in">File</span> expectedJson = ExternalNativeBuildTaskUtils.getOutputJson(getJsonFolder(), abi);</span><br><span class="line">Files.<span class="built_in">write</span>(actualResult, expectedJson, Charsets.UTF_8);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ExternalNativeBuildTaskUtils.getOutputJson</span></span><br><span class="line"><span class="comment"> * Utility function that gets the name of the output JSON for a particular ABI.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@NonNull</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">File</span> getOutputJson(@NonNull <span class="built_in">File</span> jsonFolder, @NonNull <span class="keyword">String</span> abi) {</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">new</span> <span class="built_in">File</span>(getOutputFolder(jsonFolder, abi), <span class="string">&quot;android_gradle_build.json&quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>NativeBuildConfigValue&#x7684;build&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF0C;&#x603B;&#x800C;&#x8A00;&#x4E4B;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x3002;</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Builds the {@link NativeBuildConfigValue} from the given information.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@NonNull</span><br><span class="line"><span class="keyword">public</span> NativeBuildConfigValue build() {</span><br><span class="line">    findLibraryNames();</span><br><span class="line">    findToolchainNames();</span><br><span class="line">    findToolChainCompilers();</span><br><span class="line"></span><br><span class="line">    NativeBuildConfigValue <span class="built_in">config</span> = <span class="keyword">new</span> NativeBuildConfigValue();</span><br><span class="line">    <span class="comment">// Sort by library name so that output is stable</span></span><br><span class="line">    Collections.sort(outputs, (o1, o2) -&gt; o1.libraryName.compareTo(o2.libraryName));</span><br><span class="line">    <span class="built_in">config</span>.cleanCommands = generateCleanCommands();</span><br><span class="line">    <span class="built_in">config</span>.buildFiles = Lists.newArrayList(androidMk);</span><br><span class="line">    <span class="built_in">config</span>.libraries = generateLibraries();</span><br><span class="line">    <span class="built_in">config</span>.toolchains = generateToolchains();</span><br><span class="line">    <span class="built_in">config</span>.cFileExtensions = generateExtensions(cFileExtensions);</span><br><span class="line">    <span class="built_in">config</span>.cppFileExtensions = generateExtensions(cppFileExtensions);</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">config</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x751F;&#x6210;&#x7684;json&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5C31;&#x4E0D;&#x8D34;&#x4E86;&#xFF0C;&#x540C;cmake&#x3002;</p></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>赏</span></button><div id="QR" style="display:block"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechat.png" alt="区长 WeChat Pay"><p>微信打赏</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Android/" rel="tag"># Android</a> <a href="/tags/NDK/" rel="tag"># NDK</a> <a href="/tags/Android-Gradle-Plugin/" rel="tag"># Android Gradle Plugin</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/06/22/NDK交叉编译常用变量/" rel="next" title="NDK 交叉编译常用变量"><i class="fa fa-chevron-left"></i> NDK 交叉编译常用变量</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/06/27/cmake-交叉编译/" rel="prev" title="cmake 交叉编译">cmake 交叉编译 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="jiathis_style"><a class="jiathis_button_tsina"></a> <a class="jiathis_button_tqq"></a> <a class="jiathis_button_weixin"></a> <a class="jiathis_button_cqq"></a> <a class="jiathis_button_douban"></a> <a class="jiathis_button_renren"></a> <a class="jiathis_button_qzone"></a> <a class="jiathis_button_kaixin001"></a> <a class="jiathis_button_copy"></a> <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="区长"><p class="site-author-name" itemprop="name">区长</p><p class="site-description motion-element" itemprop="description">Android Developer</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">40</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">63</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/lizhangqu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="http://www.zhihu.com/people/zhangqu-li" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i> 知乎 </a></span><span class="links-of-author-item"><a href="http://weibo.com/sbsujjbcy" target="_blank" title="微博"><i class="fa fa-fw fa-globe"></i> 微博 </a></span><span class="links-of-author-item"><a href="https://twitter.com/lizhangqu0504" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter </a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114779957383765957041" target="_blank" title="G+"><i class="fa fa-fw fa-globe"></i> G+</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://blog.csdn.net/sbsujjbcy" title="区长的CSDN" target="_blank">区长的CSDN</a></li><li class="links-of-blogroll-item"><a href="https://geminiwen.xyz/" title="geminiwen" target="_blank">geminiwen</a></li><li class="links-of-blogroll-item"><a href="https://www.camnter.com/" title="camnter" target="_blank">camnter</a></li><li class="links-of-blogroll-item"><a href="http://rarnu.xyz/" title="何老师" target="_blank">何老师</a></li><li class="links-of-blogroll-item"><a href="http://dim.red/" title="Dim" target="_blank">Dim</a></li><li class="links-of-blogroll-item"><a href="http://abner-nimengbo.cn/" title="轩辕布" target="_blank">轩辕布</a></li><li class="links-of-blogroll-item"><a href="http://blog.zhaiyifan.cn/" title="mark禽" target="_blank">mark禽</a></li><li class="links-of-blogroll-item"><a href="http://kaedea.com/" title="魔法使kaedea" target="_blank">魔法使kaedea</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cmake"><span class="nav-number">2.</span> <span class="nav-text">cmake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ndkBuild"><span class="nav-number">3.</span> <span class="nav-text">ndkBuild</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 - <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">区长</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var disqus_shortname="fucknmb-com",disqus_identifier="2017/06/24/Android-Gradle-Plugin源码解析之externalNativeBuild/",disqus_title="Android Gradle Plugin 源码解析之 externalNativeBuild";function run_disqus_script(i){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/"+i,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}run_disqus_script("count.js");var disqus_config=function(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title=disqus_title};run_disqus_script("embed.js")</script><script type="text/javascript">var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var searchFunc=function(e,c,n){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(c),r=document.getElementById(n);a.addEventListener("input",function(){var u=0,d='<ul class="search-result-list">',f=this.value.trim().toLowerCase().split(/[\s\-]+/);r.innerHTML="",1<this.value.trim().length&&t.forEach(function(e){var a=!1,r=e.title.trim().toLowerCase(),c=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),t=decodeURIComponent(e.url),n=-1,s=-1,o=-1;if(""!=r&&f.forEach(function(e,t){n=r.indexOf(e),s=c.indexOf(e),(0<=n||0<=s)&&(a=!0,0==t&&(o=s))}),a){u+=1,d+="<li><a href='"+t+"' class='search-result-title'>"+r+"</a>";var i=e.content.trim().replace(/<[^>]+>/g,"");if(0<=o){var l=o-20,p=o+80;l<0&&(l=0),0==l&&(p=50),p>i.length&&(p=i.length);var h=i.substring(l,p);f.forEach(function(e){var t=new RegExp(e,"gi");h=h.replace(t,'<b class="search-keyword">'+e+"</b>")}),d+='<p class="search-result">'+h+"...</p>"}d+="</li>"}}),d+="</ul>",0==u&&(d='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==f&&(d='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),r.innerHTML=d}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>