<!doctype html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Android,Gradle,Transform,"><link rel="alternate" href="/atom.xml" title="区长" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="&amp;#x968F;&amp;#x7740;android gradle plugin(&amp;#x4EE5;&amp;#x4E0B;&amp;#x7B80;&amp;#x79F0;agp)&amp;#x7248;&amp;#x672C;&amp;#x7684;&amp;#x8FED;&amp;#x4EE3;&amp;#xFF0C;&amp;#x88AB;google&amp;#x5E26;&amp;#x8FDB;&amp;#x6765;&amp;#x7684;bug&amp;#x4E5F;&amp;#x8D8A;&amp;#x6765;&amp;#x8D"><meta name="keywords" content="Android,Gradle,Transform"><meta property="og:type" content="article"><meta property="og:title" content="治治这个 google 一年没修的 agp transform bug"><meta property="og:url" content="https://fucknmb.com/2019/06/28/治治这个google一年没修的agp-transform-bug/index.html"><meta property="og:site_name" content="区长"><meta property="og:description" content="&amp;#x968F;&amp;#x7740;android gradle plugin(&amp;#x4EE5;&amp;#x4E0B;&amp;#x7B80;&amp;#x79F0;agp)&amp;#x7248;&amp;#x672C;&amp;#x7684;&amp;#x8FED;&amp;#x4EE3;&amp;#xFF0C;&amp;#x88AB;google&amp;#x5E26;&amp;#x8FDB;&amp;#x6765;&amp;#x7684;bug&amp;#x4E5F;&amp;#x8D8A;&amp;#x6765;&amp;#x8D"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://fucknmb.com/2019/06/28/治治这个google一年没修的agp-transform-bug/bug-commit.png"><meta property="og:updated_time" content="2019-10-20T01:38:21.329Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="治治这个 google 一年没修的 agp transform bug"><meta name="twitter:description" content="&amp;#x968F;&amp;#x7740;android gradle plugin(&amp;#x4EE5;&amp;#x4E0B;&amp;#x7B80;&amp;#x79F0;agp)&amp;#x7248;&amp;#x672C;&amp;#x7684;&amp;#x8FED;&amp;#x4EE3;&amp;#xFF0C;&amp;#x88AB;google&amp;#x5E26;&amp;#x8FDB;&amp;#x6765;&amp;#x7684;bug&amp;#x4E5F;&amp;#x8D8A;&amp;#x6765;&amp;#x8D"><meta name="twitter:image" content="https://fucknmb.com/2019/06/28/治治这个google一年没修的agp-transform-bug/bug-commit.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://fucknmb.com/2019/06/28/治治这个google一年没修的agp-transform-bug/"><title>治治这个 google 一年没修的 agp transform bug | 区长</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b5e95713d9398479a8df5c83e0159382";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">区长</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">业精于勤,荒于嬉; 行成于思,毁于随</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://fucknmb.com/2019/06/28/治治这个google一年没修的agp-transform-bug/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="区长"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="区长"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="区长" src=""></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline">治治这个 google 一年没修的 agp transform bug</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-28T11:39:09+08:00">2019-06-28 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2019/06/28/治治这个google一年没修的agp-transform-bug/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/28/治治这个google一年没修的agp-transform-bug/" itemprop="commentCount"></span> </a></span><span class="post-meta-divider">|</span> <span class="page-pv"><i class="fa fa-file-o"></i> <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>&#x968F;&#x7740;android gradle plugin(&#x4EE5;&#x4E0B;&#x7B80;&#x79F0;agp)&#x7248;&#x672C;&#x7684;&#x8FED;&#x4EE3;&#xFF0C;&#x88AB;google&#x5E26;&#x8FDB;&#x6765;&#x7684;bug&#x4E5F;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x3002;&#x76EE;&#x524D;&#x6574;&#x4F53;&#x6765;&#x770B;&#xFF0C;agp 3.1.4&#x662F;&#x6BD4;&#x8F83;&#x7A33;&#x5B9A;&#x7684;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x5176;&#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#x591A;&#x591A;&#x5C11;&#x5C11;&#x90FD;&#x6709;&#x70B9;&#x95EE;&#x9898;&#xFF08;&#x5982; agp3.2.0-3.5.0&#x7684;&#x7248;&#x672C;R8&#xFF0C;multidex&#x90FD;&#x6709;&#x95EE;&#x9898;&#x7B49;&#x7B49;&#xFF09;&#xFF0C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x4E00;&#x4E2A;&#x5728;2018&#x5E74;5&#x6708;&#x4EFD;&#x88AB;google&#x5E26;&#x8FDB;&#x6765;&#x7684;bug&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4FEE;&#x590D;&#x5B83;&#x3002;&#x8BE5;bug&#x4ECE;agp 3.2.0&#x5F00;&#x59CB;&#x5B58;&#x5728;&#xFF0C;&#x76F4;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62; agp 3.5.0 &#x4E2D;&#x4F9D;&#x65E7;&#x672A;&#x4FEE;&#x590D;&#x8BE5;&#x95EE;&#x9898;&#x3002;&#x8BE5;&#x95EE;&#x9898;&#x4F1A;&#x76F4;&#x63A5;&#x5F71;&#x54CD;&#x7F16;&#x8BD1;&#x901F;&#x5EA6;&#xFF0C;&#x539F;&#x672C;&#x80FD;&#x591F;&#x6784;&#x5EFA;&#x6210;&#x529F;&#x7684;&#x4E00;&#x6B21;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x95EE;&#x9898;&#xFF0C;&#x5FC5;&#x987B;clean&#x540E;&#x518D;&#x8FDB;&#x884C;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6D6A;&#x8D39;&#x7F16;&#x8BD1;&#x65F6;&#x95F4;&#xFF0C;&#x8FDB;&#x800C;&#x964D;&#x4F4E;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x7ED5;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x628A;&#x4F60;&#x7ED5;&#x6655;&#xFF0C;&#x5982;&#x679C;&#x628A;&#x4F60;&#x7ED5;&#x6655;&#x4E86;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x62C9;&#x5230;&#x6700;&#x540E;&#x9762;&#x770B;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x3002;</p><a id="more"></a><h3 id="&#x95EE;&#x9898;&#x63CF;&#x8FF0;"><a href="#&#x95EE;&#x9898;&#x63CF;&#x8FF0;" class="headerlink" title="&#x95EE;&#x9898;&#x63CF;&#x8FF0;"></a>&#x95EE;&#x9898;&#x63CF;&#x8FF0;</h3><p>&#x5728;agp 3.2.0&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x65F6;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x53C2;&#x4E0E;&#x8FC7;&#x7F16;&#x8BD1;&#x7684;&#x4F9D;&#x8D56;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x5219;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x4E24;&#x4E2A;&#x573A;&#x666F;&#x5982;&#x4E0B;&#xFF1A;</p><p>&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF1A;A&#x6A21;&#x5757;&#x6709;&#x81F3;&#x5C11;&#x6CE8;&#x518C;&#x4E86;&#x4E24;&#x4E2A;transform&#xFF0C;&#x5E76;&#x4E14;&#x90FD;&#x652F;&#x6301;&#x589E;&#x91CF;&#x7F16;&#x8BD1;</p><ul><li>A&#x6A21;&#x5757;&#x4EE5;project&#x65B9;&#x5F0F;&#x4F9D;&#x8D56;B&#x6A21;&#x5757;&#xFF0C;&#x9996;&#x5148;&#x5BF9;A&#x6A21;&#x5757;&#x8FDB;&#x884C;clean&#x540E;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x7136;&#x540E;&#x5C06;B&#x6A21;&#x5757;&#x53D1;&#x5E03;&#x6210;&#x8FDC;&#x7A0B;aar&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x518D;&#x5C06;A&#x6A21;&#x5757;&#x4E2D;&#x5BF9;B&#x6A21;&#x5757;&#x7684;project&#x4F9D;&#x8D56;&#x4FEE;&#x6539;&#x6210;aar&#x8FDC;&#x7A0B;&#x4F9D;&#x8D56;&#xFF0C;&#x4E0D;&#x8FDB;&#x884C;clean&#x518D;&#x5BF9;A&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#x3002;</li><li>A&#x6A21;&#x5757;&#x4EE5;aar&#x65B9;&#x5F0F;&#x4F9D;&#x8D56;B&#x6A21;&#x5757;&#xFF0C;&#x9996;&#x5148;&#x5BF9;A&#x6A21;&#x5757;&#x8FDB;&#x884C;clean&#x540E;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x518D;&#x66F4;&#x65B0;B&#x6A21;&#x5757;&#x4EE3;&#x7801;&#x91CD;&#x65B0;&#x53D1;&#x5E03;&#x5230;&#x8FDC;&#x7A0B;&#xFF0C;&#x4E0D;&#x8FDB;&#x884C;clean&#x518D;&#x5BF9;A&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#x3002;</li></ul><h3 id="Transform&#x7684;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x6D45;&#x6790;"><a href="#Transform&#x7684;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x6D45;&#x6790;" class="headerlink" title="Transform&#x7684;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x6D45;&#x6790;"></a>Transform&#x7684;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x6D45;&#x6790;</h3><p>&#x5BF9;&#x4E8E;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x7684;&#x5173;&#x952E;&#x6D41;&#x7A0B;&#x3002;</p><p>&#x9996;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;__content__.json&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5B58;&#x5728;&#x4E8E;&#x6BCF;&#x4E2A;transform&#x4EFB;&#x52A1;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x5939;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x91CC;&#x9762;&#x8BB0;&#x5F55;&#x4E86;&#x8BE5;transform&#x7684;&#x8F93;&#x5165;&#x6D41;&#x5386;&#x53F2;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x6BCF;&#x4E2A;transform&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x8BE5;&#x6587;&#x4EF6;&#x4F1A;&#x88AB;&#x751F;&#x6210;&#x6216;&#x5185;&#x5BB9;&#x88AB;&#x8986;&#x76D6;&#xFF0C;&#x4E00;&#x4E9B;&#x8F93;&#x5165;&#x6D41;&#x7684;&#x4FE1;&#x606F;&#x4F1A;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x4E0B;&#x6B21;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x751F;&#x6210;Collection&lt;SubStream&gt;&#x5BF9;&#x8C61;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x6821;&#x9A8C;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4F53;&#x73B0;&#x5728;present&#x5B57;&#x6BB5;&#x4E0A;&#xFF0C;&#x5982;&#x679C;present&#x4E3A;false&#x5219;&#x8868;&#x793A;&#x4E4B;&#x524D;&#x53C2;&#x4E0E;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;&#x6587;&#x4EF6;&#x73B0;&#x5728;&#x88AB;&#x79FB;&#x9664;&#x4E86;&#xFF0C;&#x8FDB;&#x800C;&#x89E6;&#x53D1;REMOVED&#x4E8B;&#x4EF6;&#x3002;</p><p>&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#x5927;&#x81F4;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;io.github.lizhangqu:library:1.0.0-SNAPSHOT:20190628.005304-2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;scopes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;EXTERNAL_LIBRARIES&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;CLASSES&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;JAR&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;present&quot;</span>: <span class="literal">true</span></span><br><span class="line">  },</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;2dfc24fed878febc33c1205ca066312b4cf393b0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;scopes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;PROJECT&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;CLASSES&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;DIRECTORY&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;present&quot;</span>: <span class="literal">true</span></span><br><span class="line">  }</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>&#x53EF;&#x4EE5;&#x91CD;&#x70B9;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;json&#x4E2D;&#x7684;index&#x5B57;&#x6BB5;&#xFF0C;&#x8BE5;&#x5B57;&#x6BB5;&#x51B3;&#x5B9A;&#x8BE5;&#x8F93;&#x5165;&#x6D41;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5982;&#x679C;&#x662F;format&#x662F;JAR&#xFF0C;&#x5219;&#x8F93;&#x51FA;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4E3A;index&#x503C;.jar&#xFF0C;&#x5982;0.jar&#xFF0C;&#x5982;&#x679C;format&#x662F;DIRECTORY&#xFF0C;&#x5219;&#x8F93;&#x51FA;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x4E3A;index&#x503C;&#xFF0C;&#x5982;1&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x8F93;&#x51FA;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x662F;&#x600E;&#x4E48;&#x6765;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;getContentLocation&#x51FD;&#x6570;&#x7684;&#x65B9;&#x5F0F;&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getName</span>(), <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.JAR</span>)</span><br><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getName</span>(), <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.DIRECTORY</span>)</span><br></pre></td></tr></table></figure><p>&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;&#x5230;&#x5982;&#x4E0B;&#x51FD;&#x6570;&#x4E2D;</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> synchronized File getContentLocation(</span><br><span class="line">        @NonNull <span class="keyword">String</span> name,</span><br><span class="line">        @NonNull Set&lt;ContentType&gt; types,</span><br><span class="line">        @NonNull Set&lt;? <span class="keyword">super</span> Scope&gt; scopes,</span><br><span class="line">        @NonNull Format format) {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// search for an existing matching substream.</span></span><br><span class="line">    <span class="keyword">for</span> (SubStream subStream : <span class="type">subStreams</span>) {</span><br><span class="line">        <span class="comment">// look for an existing match. This means same name, types, scopes, and format.</span></span><br><span class="line">        <span class="keyword">if</span> (name.equals(subStream.getName())</span><br><span class="line">                &amp;&amp; types.equals(subStream.getTypes())</span><br><span class="line">                &amp;&amp; scopes.equals(subStream.getScopes())</span><br><span class="line">                &amp;&amp; format == subStream.getFormat()) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">File</span>(rootFolder, subStream.getFilename());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// didn&apos;t find a matching output. create the new output</span></span><br><span class="line">    SubStream <span class="keyword">new</span><span class="type">SubStream</span> = <span class="keyword">new</span> <span class="type">SubStream</span>(name, nextIndex++, scopes, types, format, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    subStreams.add(<span class="keyword">new</span><span class="type">SubStream</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">File</span>(rootFolder, <span class="keyword">new</span><span class="type">SubStream</span>.getFilename());</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>subStreams&#x6700;&#x539F;&#x59CB;&#x7684;&#x503C;&#x6765;&#x81EA;__content__.json&#x6587;&#x4EF6;&#x7684;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;subStreams&#x7F13;&#x5B58;&#x4E2D;&#x6709;&#x5339;&#x914D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x5339;&#x914D;&#x7684;&#x5185;&#x5BB9;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5339;&#x914D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5219;&#x91CD;&#x65B0;new&#x4E00;&#x4E2A;SubStream&#x5E76;&#x4E14;index&#x8FDB;&#x884C;&#x9012;&#x589E;&#x3002;</p><p>&#x5BF9;&#x4E8E;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#x65F6;&#xFF0C;&#x6BCF;&#x6B21;&#x8C03;&#x7528;getContentLocation&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x6CA1;&#x6709;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;SubStream&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x90FD;&#x662F;&#x8D70;&#x4ECE;0&#x5F00;&#x59CB;&#x7684;&#x9012;&#x589E;&#x903B;&#x8F91;&#x3002;</p><p>&#x4F46;&#x662F;&#x5BF9;&#x5E94;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x6784;&#x5EFA;&#x4EA7;&#x751F;&#x4E86;__content__.json&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6267;&#x884C;transform&#x524D;&#x4F1A;&#x5148;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x6700;&#x5927;&#x7684;index+1&#x4F5C;&#x4E3A;nextIndex&#x7684;&#x8D77;&#x59CB;&#x9012;&#x589E;&#x503C;&#xFF0C;&#x5373;&#x5047;&#x5982;__content__.json&#x6587;&#x4EF6;&#x4E2D;&#x6709;n&#x4E2A;index&#xFF0C;&#x4F46;&#x662F;&#x6700;&#x5927;&#x7684;index&#x662F;5&#xFF0C;&#x5219;&#x6211;&#x4EEC;&#x8C03;&#x7528;getContentLocation&#x4E0D;&#x518D;&#x4ECE;0&#x5F00;&#x59CB;&#x9012;&#x589E;&#xFF0C;&#x800C;&#x662F;&#x4ECE;6&#x5F00;&#x59CB;&#x9012;&#x589E;&#x3002;<strong>&#x5C24;&#x5176;&#x6CE8;&#x610F;&#x8FD9;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x4ECE;0&#x5F00;&#x59CB;&#x9012;&#x589E;&#x6587;&#x4EF6;&#x540D;</strong>&#x3002;</p><p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x4E00;&#x6BB5;&#x5F88;&#x666E;&#x901A;&#x4E0D;&#x8FC7;&#x7684;transform&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5355;&#x7EAF;&#x7684;&#x6267;&#x884C;&#x62F7;&#x8D1D;&#x64CD;&#x4F5C;&#x5E76;&#x8F93;&#x51FA;&#x5404;&#x6587;&#x4EF6;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">void</span> transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException {</span><br><span class="line">    <span class="keyword">super</span>.transform(transformInvocation)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!transformInvocation.isIncremental()) {</span><br><span class="line">        transformInvocation.getOutputProvider().deleteAll();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    transformInvocation.inputs.each {</span><br><span class="line">        it.jarInputs.each {</span><br><span class="line">            File dest = transformInvocation.getOutputProvider().getContentLocation(it.getName(), it.contentTypes, it.scopes, Format.JAR)</span><br><span class="line">            <span class="keyword">if</span> (transformInvocation.isIncremental()) {</span><br><span class="line">                <span class="keyword">switch</span> (it.getStatus()) {</span><br><span class="line">                    <span class="keyword">case</span> Status.NOTCHANGED:</span><br><span class="line">                        project.logger.error <span class="string">&quot;NOTCHANGED input is: <span class="subst">${it}</span> dest: <span class="subst">${dest}</span>&quot;</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> Status.CHANGED:</span><br><span class="line">                    <span class="keyword">case</span> Status.ADDED:</span><br><span class="line">                        project.logger.error <span class="string">&quot;<span class="subst">${it.getStatus()}</span> input is: <span class="subst">${it}</span> dest: <span class="subst">${dest}</span>&quot;</span></span><br><span class="line">                        GFileUtils.copyFile(it.file, dest)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> Status.REMOVED:</span><br><span class="line">                        project.logger.error <span class="string">&quot;REMOVED input is: <span class="subst">${it}</span> dest: <span class="subst">${dest}</span>&quot;</span></span><br><span class="line">                        GFileUtils.deleteQuietly(dest)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                project.logger.error <span class="string">&quot;no incremental: <span class="subst">${it}</span>  dest: <span class="subst">${dest}</span>&quot;</span></span><br><span class="line">                GFileUtils.copyFile(it.file, dest)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        it.directoryInputs.each {</span><br><span class="line">            File inputDir = it.getFile()</span><br><span class="line">            File outputDir = transformInvocation.outputProvider.getContentLocation(it.getName(), it.contentTypes, it.scopes, Format.DIRECTORY)</span><br><span class="line">            <span class="keyword">if</span> (transformInvocation.isIncremental()) {</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">Map</span>.Entry&lt;File, Status&gt; changedInput : it.getChangedFiles().entrySet()) {</span><br><span class="line">                    File inputFile = changedInput.getKey()</span><br><span class="line">                    <span class="built_in">String</span> relativePath = com.android.utils.FileUtils.relativePossiblyNonExistingPath(inputFile, inputDir)</span><br><span class="line">                    File outputFile = <span class="keyword">new</span> File(outputDir, relativePath)</span><br><span class="line">                    <span class="keyword">switch</span> (changedInput.getValue()) {</span><br><span class="line">                        <span class="keyword">case</span> Status.NOTCHANGED:</span><br><span class="line">                            project.logger.error <span class="string">&quot;NOTCHANGED input is: <span class="subst">${it}</span> dest: <span class="subst">${outputFile}</span>&quot;</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> Status.REMOVED:</span><br><span class="line">                            project.logger.error <span class="string">&quot;REMOVED input is: <span class="subst">${it}</span> dest: <span class="subst">${outputFile}</span>&quot;</span></span><br><span class="line">                            GFileUtils.deleteQuietly(outputFile)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        <span class="keyword">case</span> Status.ADDED:</span><br><span class="line">                        <span class="keyword">case</span> Status.CHANGED:</span><br><span class="line">                            project.logger.error <span class="string">&quot;<span class="subst">${changedInput.getValue()}</span> input is: <span class="subst">${it}</span> dest: <span class="subst">${outputFile}</span>&quot;</span></span><br><span class="line">                            <span class="keyword">if</span> (inputFile.isFile() &amp;&amp; !inputFile.isDirectory()) {</span><br><span class="line">                                GFileUtils.deleteQuietly(outputFile)</span><br><span class="line">                                FileUtils.copyFile(inputFile, outputFile)</span><br><span class="line">                            }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                project.logger.error <span class="string">&quot;no incremental: <span class="subst">${it}</span> dest: <span class="subst">${outputDir}</span>&quot;</span></span><br><span class="line">                GFileUtils.deleteQuietly(outputDir)</span><br><span class="line">                FileUtils.copyDirectory(inputDir, outputDir)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;getContentLocation&#x51FD;&#x6570;&#x6765;&#x83B7;&#x53D6;&#x5F53;&#x524D;transform&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x5B83;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5165;&#x53C2;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x4F20;&#x9012;&#x4E86;it.getName()&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x8FD9;&#x4E2A;getName()&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x503C;&#x5462;&#xFF1F;</p><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x662F;aar&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;getName()&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;maven&#x5750;&#x6807;&#x663E;&#x793A;&#x503C;&#xFF1B;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x662F;project&#xFF0C;&#x5219;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x8BE5;project&#x7684;path&#x540D;&#xFF1B;&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x6BD4;&#x5982;src/main/java&#x7F16;&#x8BD1;&#x4EA7;&#x751F;&#x7684;class&#x76EE;&#x5F55;&#xFF0C;&#x5219;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x8BE5;&#x76EE;&#x5F55;&#x8DEF;&#x5F84;&#x7684;&#x54C8;&#x5E0C;&#x503C;&#x3002;&#x5982;&#x679C;&#x524D;&#x9762;&#x83B7;&#x53D6;&#x7684;&#x540D;&#x5B57;&#x4E0E;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x540D;&#x5B57;&#x5B58;&#x5728;&#x51B2;&#x7A81;&#xFF0C;&#x5219;&#x672B;&#x5C3E;&#x4F1A;&#x8FDB;&#x884C;&#x8FFD;&#x52A0;&#x4E00;&#x5B9A;&#x7684;&#x5185;&#x5BB9;&#x9632;&#x6B62;&#x51B2;&#x7A81;&#x3002;&#x540D;&#x5B57;&#x751F;&#x6210;&#x89C4;&#x5219;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#x4E24;&#x4E2A;&#x51FD;&#x6570;</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">String</span> getArtifactName(</span><br><span class="line">        <span class="meta">@NonNull</span> ResolvedArtifactResult artifactResult,</span><br><span class="line">        <span class="meta">@NonNull</span> Map&lt;ComponentIdentifier, Integer&gt; deduplicationMap) {</span><br><span class="line">    ComponentIdentifier id = artifactResult.getId().getComponentIdentifier();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> baseName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id <span class="keyword">instanceof</span> ProjectComponentIdentifier) {</span><br><span class="line">        baseName = ((ProjectComponentIdentifier) id).getProjectPath();</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (id <span class="keyword">instanceof</span> ModuleComponentIdentifier) {</span><br><span class="line">        baseName = id.getDisplayName();</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// this is a local jar</span></span><br><span class="line">        File artifactFile = artifactResult.getFile();</span><br><span class="line"></span><br><span class="line">        baseName =</span><br><span class="line">                LOCAL_JAR_GROUPID</span><br><span class="line">                        + artifactFile.getName()</span><br><span class="line">                        + <span class="string">&quot;:&quot;</span></span><br><span class="line">                        + Hashing.sha1()</span><br><span class="line">                                .hashString(artifactFile.getPath(), Charsets.UTF_16LE)</span><br><span class="line">                                .toString();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if a previous artifact use the same name. This can happen for instance in case</span></span><br><span class="line">    <span class="comment">// of an AAR with local Jars.</span></span><br><span class="line">    <span class="comment">// In that case happen an index to the name.</span></span><br><span class="line">    final Integer zero = <span class="number">0</span>;</span><br><span class="line">    Integer i =</span><br><span class="line">            deduplicationMap.compute(</span><br><span class="line">                    id,</span><br><span class="line">                    (componentIdentifier, value) -&gt; {</span><br><span class="line">                        <span class="keyword">if</span> (value == <span class="literal">null</span>) {</span><br><span class="line">                            <span class="keyword">return</span> zero;</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">return</span> value + <span class="number">1</span>;</span><br><span class="line">                    });</span><br><span class="line">    <span class="keyword">if</span> (!zero.equals(i)) {</span><br><span class="line">        <span class="keyword">return</span> baseName + <span class="string">&quot;::&quot;</span> + i;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> baseName;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">String</span> getUniqueInputName(<span class="meta">@NonNull</span> File file) {</span><br><span class="line">    <span class="keyword">return</span> Hashing.sha1().hashString(file.getPath(), Charsets.UTF_16LE).toString();</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>getName()&#x8FD4;&#x56DE;&#x503C;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x4E09;&#x79CD;&#x547D;&#x540D;&#xFF1A;</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">io</span><span class="selector-class">.github</span><span class="selector-class">.lizhangqu</span><span class="selector-pseudo">:library</span><span class="selector-pseudo">:1.0.0-SNAPSHOT</span><span class="selector-pseudo">:20190628.005304-2</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:library</span></span><br><span class="line"></span><br><span class="line">2<span class="selector-tag">dfc24fed878febc33c1205ca066312b4cf393b0</span></span><br></pre></td></tr></table></figure><p>&#x540C;&#x65F6;&#x6240;&#x6709;transform&#x4E2D;&#x8F93;&#x5165;&#x6D41;&#x7684;getName()&#x8FD4;&#x56DE;&#x503C;&#x4E0E;&#x5176;&#x4ED6;transform&#x4E2D;&#x8FD4;&#x56DE;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4E5F;&#x8981;&#x5C24;&#x5176;&#x6CE8;&#x610F;&#x3002;</p><p>&#x6BD4;&#x5982;&#x67D0;&#x4E2A;&#x4F9D;&#x8D56;&#x6839;&#x636E;&#x5982;&#x4E0A;&#x547D;&#x540D;&#x89C4;&#x5219;&#x8FD4;&#x56DE;&#x7684;getName()&#x662F;2dfc24fed878febc33c1205ca066312b4cf393b0&#xFF0C;&#x90A3;&#x4E48;&#x5728;ATransform&#x4E2D;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;2dfc24fed878febc33c1205ca066312b4cf393b0&#xFF0C;BTransform&#x4E2D;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;getName()&#x8FD4;&#x56DE;&#x7684;&#x4E5F;&#x662F;2dfc24fed878febc33c1205ca066312b4cf393b0&#xFF0C;CTransform&#x4E2D;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;getName()&#x8FD4;&#x56DE;&#x7684;&#x540C;&#x6837;&#x662F;2dfc24fed878febc33c1205ca066312b4cf393b0&#xFF0C;&#x5373;&#x540C;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x5728;&#x6570;&#x636E;&#x6D41;&#x5411;&#x8FC7;&#x7A0B;&#x4E2D;&#x5176;getName()&#x8FD4;&#x56DE;&#x503C;&#x4FDD;&#x6301;&#x4E86;&#x552F;&#x4E00;&#x6027;&#x3002;</p><p>&#x4E86;&#x89E3;&#x4E86;&#x4EE5;&#x4E0A;&#x5185;&#x5BB9;&#x540E;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4E00;&#x4E2A;&#x5F88;&#x5173;&#x952E;&#x7684;&#x5185;&#x5BB9;&#x3002;</p><p>&#x5982;&#x679C;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x4E2A;&#x4F9D;&#x8D56;&#x6587;&#x4EF6;&#x88AB;&#x79FB;&#x9664;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x4F9D;&#x8D56;&#x662F;OriginalStream&#x7C7B;&#x578B;&#xFF0C;&#x7531;&#x4E8E;&#x8BE5;transform&#x6D88;&#x8D39;&#x4E86;OriginalStream&#xFF0C;&#x5373;&#x6D88;&#x8D39;&#x4E86;&#x4E0D;&#x662F;&#x7531;transform&#x4EA7;&#x751F;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x662F;&#x6700;&#x539F;&#x59CB;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x5373;&#x4F7F;&#x8BE5;transform&#x652F;&#x6301;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x4E5F;&#x4F1A;&#x88AB;&#x5224;&#x65AD;&#x6210;&#x5FC5;&#x987B;&#x8FDB;&#x884C;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#x3002;</p><p>&#x4E3E;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5047;&#x5982;&#x6211;&#x6CE8;&#x518C;&#x4E86;&#x4E24;&#x4E2A;Transform&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;FirstTransform&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;SecondTransform&#xFF0C;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6211;&#x5347;&#x7EA7;&#x4E86;&#x5176;&#x4E2D;&#x67D0;&#x4E00;&#x4E2A;aar&#x518D;&#x8FDB;&#x884C;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x8FD9;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;gradle&#x8BA4;&#x4E3A;&#x65B0;&#x589E;&#x4E86;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x540C;&#x65F6;&#x65E7;&#x7248;&#x672C;&#x7684;&#x6587;&#x4EF6;&#x88AB;&#x79FB;&#x9664;&#x4E86;&#xFF0C;&#x5F53;&#x6267;&#x884C;&#x5230;FirstTransform&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x6587;&#x4EF6;&#x4E0D;&#x662F;&#x7531;transform&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x5373;&#x5339;&#x914D;&#x4E0D;&#x5230;&#x76F8;&#x5173;&#x6587;&#x4EF6;&#xFF0C;&#x89E6;&#x53D1;FirstTransform&#x8FDB;&#x884C;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x4F46;&#x662F;&#x7B49;SecondTransform&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x589E;&#x6587;&#x4EF6;&#x548C;&#x4E00;&#x4E2A;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x6587;&#x4EF6;&#x662F;&#x4E0A;&#x4E00;&#x4E2A;FirstTransform&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x5373;&#x4E0D;&#x662F;OriginalStream&#x5374;&#x662F;IntermediateStream&#xFF0C;&#x6240;&#x4EE5;SecondTransform&#x5728;&#x5176;&#x4ED6;&#x6761;&#x4EF6;&#x90FD;&#x6EE1;&#x8DB3;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x89E6;&#x53D1;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x3002;</p><h3 id="Bug&#x518D;&#x73B0;"><a href="#Bug&#x518D;&#x73B0;" class="headerlink" title="Bug&#x518D;&#x73B0;"></a>Bug&#x518D;&#x73B0;</h3><p>&#x6709;&#x4E86;&#x4EE5;&#x4E0A;&#x7406;&#x8BBA;&#x57FA;&#x7840;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x600E;&#x4E48;&#x590D;&#x73B0;&#x8FD9;&#x4E2A;bug&#x3002;</p><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;3.1.4&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5373;&#x5B8C;&#x5168;&#x6CA1;&#x95EE;&#x9898;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;</p><p>&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E9B;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF1A;&#x73B0;&#x6709;A&#x5DE5;&#x7A0B;&#x548C;B&#x5DE5;&#x7A0B;&#xFF0C;&#x5E76;&#x4E14;A&#x5DE5;&#x7A0B;apply&#x4E86;&#x4E00;&#x4E2A;gradle&#x63D2;&#x4EF6;&#xFF0C;&#x8BE5;gradle&#x63D2;&#x4EF6;&#x4E2D;&#x6CE8;&#x518C;&#x4E86;&#x4E24;&#x4E2A;Transform&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;FirstTransform&#xFF0C;&#x4E00;&#x4E2A;&#x53EB;SecondTransform&#xFF0C;&#x9996;&#x5148;&#x8BA9;A&#x5DE5;&#x7A0B;&#x4EE5;project&#x4F9D;&#x8D56;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x4F9D;&#x8D56;&#xFF0C;&#x6267;&#x884C;&#x5168;&#x91CF;&#x6784;&#x5EFA;</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew <span class="symbol">:A</span><span class="symbol">:clean</span> <span class="symbol">:A</span><span class="symbol">:assembleDebug</span></span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E;&#x662F;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;__content__.json&#x90FD;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5F53;&#x8C03;&#x7528;getContentLocation&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6587;&#x4EF6;&#x540D;&#x547D;&#x540D;&#x89C4;&#x5219;&#x4ECE;0&#x5F00;&#x59CB;&#x9012;&#x589E;&#xFF0C;&#x5047;&#x8BBE;&#x6B64;&#x65F6;&#x6709;&#x4E24;&#x4E2A;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x4E2A;jar&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x76EE;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;FirstTransform&#x6B63;&#x5E38;&#x6765;&#x8BF4;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;jar&#x6587;&#x4EF6;&#x548C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x5206;&#x522B;&#x4E3A;first/0.jar&#x548C;first/1&#xFF0C;&#x5047;&#x5982;&#x6B64;&#x65F6;B&#x5DE5;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x4E3A;first/0.jar&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x6267;&#x884C;&#x5230;SecondTransform&#x65F6;&#xFF0C;&#x548C;&#x524D;&#x9762;&#x4E00;&#x6837;&#xFF0C;&#x4E5F;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;jar&#x6587;&#x4EF6;&#x548C;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x5206;&#x522B;&#x662F;second/0.jar&#x548C;second/1&#xFF0C;&#x6B64;&#x65F6;B&#x5DE5;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x4E3A;second/0.jar&#x3002;&#x6CE8;&#x610F;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;B&#x5DE5;&#x7A0B;&#x7684;getName()&#x8FD4;&#x56DE;&#x7684;&#x4E00;&#x76F4;&#x662F;B&#x5DE5;&#x7A0B;&#x7684;project path&#x540D;&#x3002;</p><p>&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;B&#x5DE5;&#x7A0B;&#x53D1;&#x5E03;&#x6210;&#x8FDC;&#x7A0B;aar&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x5C06;A&#x5DE5;&#x7A0B;&#x5BF9;B&#x5DE5;&#x7A0B;&#x7684;project&#x4F9D;&#x8D56;&#x4FEE;&#x6539;&#x6210;aar&#x4F9D;&#x8D56;&#xFF0C;&#x6267;&#x884C;&#x589E;&#x91CF;&#x6784;&#x5EFA;</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew <span class="symbol">:A</span><span class="symbol">:assembleDebug</span></span><br></pre></td></tr></table></figure><p>&#x7531;&#x4E8E;&#x662F;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x4E00;&#x6B21;&#x6784;&#x5EFA;&#x4EA7;&#x751F;&#x7684;__content__.json&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x7531;&#x4E8E;&#x4E4B;&#x524D;&#x4EA7;&#x751F;&#x4E86;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;&#x5982;&#x679C;index&#x4F1A;&#x4ECE;2&#x5F00;&#x59CB;&#x9012;&#x589E;&#x3002;&#x518D;&#x52A0;&#x4E0A;FirstTransform&#x662F;&#x7B2C;&#x4E00;&#x4E2A;transform&#x5E76;&#x4E14;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x589E;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5373;B&#x7684;aar&#x4F9D;&#x8D56;&#xFF0C;&#x6B64;&#x65F6;B&#x7684;aar&#x4F9D;&#x8D56;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x8BE5;&#x4F9D;&#x8D56;&#x7684;maven&#x5750;&#x6807;&#x663E;&#x793A;&#x503C;&#xFF1B;&#x540C;&#x65F6;&#x79FB;&#x9664;&#x4E86;&#x4E00;&#x4E2A;&#x65E7;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x5373;B&#x7684;project&#x4F9D;&#x8D56;&#xFF0C;&#x5176;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;B&#x5DE5;&#x7A0B;&#x7684;project path&#x540D;&#x3002;&#x6B64;&#x65F6;FirstTransform&#x4F1A;&#x5F3A;&#x5236;&#x89E6;&#x53D1;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x65F6;&#x65B0;&#x589E;&#x7684;aar&#x4F9D;&#x8D56;&#x901A;&#x8FC7;getContentLocation&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;first/2.jar&#xFF0C;&#x800C;&#x4E0D;&#x518D;&#x662F;first/0.jar&#x6216;&#x8005;first/1&#xFF0C;&#x56E0;&#x4E3A;&#x7F13;&#x5B58;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;B&#x7684;aar&#x4F9D;&#x8D56;&#x5BF9;&#x5E94;&#x7684;SubStream&#xFF0C;&#x6240;&#x4EE5;&#x6587;&#x4EF6;&#x540D;&#x8FDB;&#x884C;&#x4E86;&#x9012;&#x589E;&#x64CD;&#x4F5C;&#x3002;&#x5047;&#x5982;B&#x7684;project&#x4F9D;&#x8D56;&#x4E4B;&#x524D;&#x4EA7;&#x751F;&#x7684;&#x662F;first/0.jar&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;FirstTransform&#x4F1A;&#x4EA7;&#x751F;&#x4E24;&#x4E2A;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#xFF0C;&#x5373;first/1&#x548C;first/2.jar&#xFF0C;&#x800C;first/0.jar&#x7531;&#x4E8E;&#x662F;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p><p>&#x5F53;&#x6267;&#x884C;&#x5230;SecondTransform&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x589E;&#x6587;&#x4EF6;&#x548C;&#x4E00;&#x4E2A;&#x5220;&#x9664;&#x6587;&#x4EF6;&#xFF0C;&#x5373;first/2.jar&#x662F;&#x65B0;&#x589E;&#x6587;&#x4EF6;&#xFF0C;first/0.jar&#x662F;&#x5220;&#x9664;&#x6587;&#x4EF6;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x7531;&#x4E8E;&#x8BE5;transform&#x4E0A;&#x4E00;&#x6B21;&#x6784;&#x5EFA;&#x4EA7;&#x751F;&#x7684;__content__.json&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x4F1A;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;index&#x4F1A;&#x4ECE;2&#x5F00;&#x59CB;&#x9012;&#x589E;&#x3002;&#x56E0;&#x6B64;&#x65B0;&#x589E;&#x6587;&#x4EF6;first/2.jar&#x83B7;&#x53D6;&#x5230;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x4E3A;second/2.jar&#xFF0C;&#x56E0;&#x4E3A;first/2.jar&#x5BF9;&#x5E94;B&#x6A21;&#x5757;&#x7684;aar&#x4F9D;&#x8D56;&#xFF0C;&#x5176;getName()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x5176;maven&#x5750;&#x6807;&#x663E;&#x793A;&#x503C;&#xFF0C;&#x6CA1;&#x6709;&#x7F13;&#x5B58;&#x7684;SubStream&#x4E0E;&#x5176;&#x5339;&#x914D;&#xFF0C;&#x6240;&#x4EE5;&#x547D;&#x540D;&#x89C4;&#x5219;&#x8FDB;&#x884C;&#x4E86;&#x9012;&#x589E;&#xFF0C;&#x5373;second/2.jar&#xFF0C;&#x800C;&#x5220;&#x9664;&#x6587;&#x4EF6;first/0.jar&#x83B7;&#x53D6;&#x5230;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x4E3A;second/0.jar&#x662F;&#x56E0;&#x4E3A;&#x6709;&#x5DF2;&#x5B58;&#x5728;&#x7684;SubStream&#x4E0E;&#x5176;&#x5339;&#x914D;&#xFF0C;&#x8FD4;&#x56DE;&#x5176;&#x539F;&#x5148;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x7531;&#x4E8E;&#x88AB;&#x6807;&#x8BB0;&#x6210;&#x5220;&#x9664;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x88AB;&#x6211;&#x4EEC;&#x5220;&#x6389;&#x3002;</p><p>&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x62BD;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x8D34;&#x4E00;&#x4E0B;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x4F1A;&#x6BD4;&#x8F83;&#x597D;&#x7406;&#x89E3;</p><p>&#x5168;&#x91CF;&#x6784;&#x5EFA;&#x7684;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithFirstForDebug</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=:library, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/library/</span>build<span class="regexp">/intermediates/</span>intermediate-jars<span class="regexp">/debug/</span>classes.jar, <span class="comment">//&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span></span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=SUB_PROJECTS, </span><br><span class="line">	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=<span class="number">2</span>dfc24fed878febc33c1205ca066312b4cf393b0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>classes<span class="regexp">/debug, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, </span><br><span class="line">	changedFiles={}},</span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithSecondForDebug</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=:library, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=SUB_PROJECTS, </span><br><span class="line">	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=<span class="number">2</span>dfc24fed878febc33c1205ca066312b4cf393b0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, </span><br><span class="line">	changedFiles={}},</span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br></pre></td></tr></table></figure><p>&#x589E;&#x91CF;&#x6784;&#x5EFA;&#x7684;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithFirstForDebug</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=io.github.<span class="string">lizhangqu:</span><span class="string">library:</span><span class="number">1.0</span><span class="number">.0</span>-<span class="string">SNAPSHOT:</span><span class="number">20190628.005304</span><span class="number">-2</span>, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/.gradle/</span>caches<span class="regexp">/transforms-2/</span>files<span class="number">-2.1</span><span class="regexp">/a2f8c54095c8cb773914a91454ca0aea/</span>jars<span class="regexp">/classes.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=EXTERNAL_LIBRARIES, </span><br><span class="line">	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/2.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;&#x662F;<span class="number">2.</span>jar</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=<span class="number">2</span>dfc24fed878febc33c1205ca066312b4cf393b0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>classes<span class="regexp">/debug, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, changedFiles={}} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithSecondForDebug</span><br><span class="line"></span><br><span class="line">REMOVED input <span class="string">is:</span> </span><br><span class="line">ImmutableJarInput{<span class="comment">//&#x6CE8;&#x610F;&#x6B64;&#x72B6;&#x6001;&#x88AB;&#x6807;&#x8BB0;&#x6210;&#x5220;&#x9664;</span></span><br><span class="line">	name=:library, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=SUB_PROJECTS, </span><br><span class="line">	status=REMOVED} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">ADDED input <span class="string">is:</span> </span><br><span class="line">ImmutableJarInput{<span class="comment">//&#x6CE8;&#x610F;&#x6B64;&#x72B6;&#x6001;&#x88AB;&#x6807;&#x8BB0;&#x6210;&#x65B0;&#x589E;</span></span><br><span class="line">	name=io.github.<span class="string">lizhangqu:</span><span class="string">library:</span><span class="number">1.0</span><span class="number">.0</span>-<span class="string">SNAPSHOT:</span><span class="number">20190628.005304</span><span class="number">-2</span>, <span class="comment">//&#x6CE8;&#x610F;&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/2.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;&#x662F;<span class="number">2.</span>jar</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=EXTERNAL_LIBRARIES, </span><br><span class="line">	status=ADDED} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/2.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;&#x662F;<span class="number">2.</span>jar</span><br></pre></td></tr></table></figure><p>&#x4F46;&#x662F;&#x4EE5;&#x4E0A;&#x903B;&#x8F91;&#x5728;agp 3.2.0&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x5E76;&#x4E0D;&#x6210;&#x7ACB;&#xFF0C;&#x5728;2018&#x5E74;5&#x6708;14&#x65E5;&#x7684;&#x65F6;&#x5019;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x63D0;&#x4EA4;&#xFF0C;&#x5982;&#x4E0B;</p><p><img src="/2019/06/28/&#x6CBB;&#x6CBB;&#x8FD9;&#x4E2A;google&#x4E00;&#x5E74;&#x6CA1;&#x4FEE;&#x7684;agp-transform-bug/bug-commit.png" alt="bug-commit.png"></p><p>&#x5373;</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function">TransformOutputProvider <span class="title">asOutput</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TransformOutputProviderImpl(folderUtils);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x88AB;&#x4FEE;&#x6539;&#x6210;&#x4E86;</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function">TransformOutputProvider <span class="title">asOutput</span><span class="params">(<span class="keyword">boolean</span> isIncremental)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    <span class="keyword">if</span> (!isIncremental) {</span><br><span class="line">        FileUtils.deleteIfExists(<span class="keyword">new</span> File(getRootLocation(), SubStream.FN_FOLDER_CONTENT));</span><br><span class="line">    }</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TransformOutputProviderImpl(folderUtils);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x4F1A;&#x9020;&#x6210;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x5462;&#xFF1F;</p><p>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8BF4;&#x8FC7;&#x5F53;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x65F6;&#xFF0C;&#x79FB;&#x9664;&#x4E86;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x8BE5;&#x6587;&#x4EF6;&#x4E0D;&#x662F;transform&#x4EA7;&#x751F;&#x800C;&#x662F;&#x539F;&#x59CB;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x4F1A;&#x89E6;&#x53D1;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x5F53;&#x89E6;&#x53D1;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#x540E;&#xFF0C;&#x5728;agp 3.2.0&#x4EE5;&#x4E0A;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x7531;&#x4E8E;&#x52A0;&#x4E86;&#x5982;&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;FirstTransform&#x7684;__content__.json&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x6B64;&#x65F6;FirstTransform&#x4E2D;&#x6587;&#x4EF6;&#x540D;&#x547D;&#x540D;&#x89C4;&#x5219;&#x5F52;0&#x8FDB;&#x884C;&#x9012;&#x589E;&#x3002;&#x5373;&#x5F53;&#x6267;&#x884C;&#x5230;FirstTransform&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8F93;&#x51FA;&#x7684;&#x4F9D;&#x65E7;&#x662F;first/0.jar&#x548C;first/1&#xFF0C;&#x5BF9;&#x4E8E;SecondTransform&#x6765;&#x8BF4;&#xFF0C;gradle&#x611F;&#x77E5;&#x5230;&#x7684;&#x53EA;&#x6709;&#x6587;&#x4EF6;&#x53D8;&#x5316;&#x3002;&#x4F9D;&#x65E7;&#x662F;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x6240;&#x4EE5;__content__.json&#x6587;&#x4EF6;&#x4E0D;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x4F1A;&#x88AB;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x3002;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;B&#x5DE5;&#x7A0B;&#x7684;aar&#x4F9D;&#x8D56;&#x8FD4;&#x56DE;&#x7684;getName()&#x4E0E;&#x5176;project&#x4F9D;&#x8D56;&#x8FD4;&#x56DE;&#x7684;getName()&#x503C;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;SecondTransform&#x83B7;&#x53D6;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#x4F1A;&#x4ECE;2&#x5F00;&#x59CB;&#x9012;&#x589E;&#x3002;&#x4F46;&#x662F;&#x5176;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x540D;&#x5E76;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x5373;first/0.jar&#x548C;first/1&#xFF0C;&#x56E0;&#x4E3A;&#x6587;&#x4EF6;&#x540D;&#x90FD;&#x6CA1;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x65F6;ADD&#x548C;REMOVED&#x90FD;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#xFF0C;&#x53EA;&#x4F1A;&#x89E6;&#x53D1;first/0.jar&#x7684;CHANGED&#x4E8B;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x540D;&#x662F;second/0.jar&#x548C;second/1&#x5417;&#xFF1F;&#x95EE;&#x9898;&#x5C31;&#x5728;&#x8FD9;&#xFF0C;&#x5F88;&#x660E;&#x786E;&#x7684;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;&#x5982;&#x679C;getContentLocation&#x4F20;&#x9012;&#x4E86;it.getName()&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x662F;second/1&#x548C;second/2.jar&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x662F;second/0.jar&#x548C;second/1&#x5462;&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;&#x4F9D;&#x8D56;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;getName()&#x81EA;&#x7136;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x7F13;&#x5B58;&#x4E2D;&#x627E;&#x4E0D;&#x5230;&#x8BE5;name&#x5BF9;&#x5E94;&#x7684;SubStream&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#xFF0C;&#x8FDB;&#x884C;index&#x9012;&#x589E;&#x3002;</p><p>&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#xFF1F;&#x6CA1;&#x9519;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x539F;&#x5148;&#x7684;second/0.jar&#x6587;&#x4EF6;&#x65E2;&#x6CA1;&#x6709;REMOVED&#x4E8B;&#x4EF6;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x88AB;agp&#x5220;&#x9664;&#xFF0C;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;second/0.jar&#x548C;second/2.jar&#x5171;&#x5B58;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E24;&#x4E2A;jar&#x4E2D;&#x6709;&#x76F8;&#x540C;&#x7684;&#x7C7B;&#xFF01;&#xFF01;&#xFF01;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#xFF01;&#xFF01;&#xFF01;</p><p>&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x4E00;&#x4E0B;agp 3.2.0+&#x7684;&#x65E5;&#x5FD7;</p><p>&#x5168;&#x91CF;&#x6784;&#x5EFA;&#x7684;&#x65E5;&#x5FD7;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithFirstForDebug</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=:library, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/library/</span>build<span class="regexp">/intermediates/</span>intermediate-jars<span class="regexp">/debug/</span>classes.jar, <span class="comment">//&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span></span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=SUB_PROJECTS, </span><br><span class="line">	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=a27851442c2ece1ee6b26af1b09d88e2bbc785d0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>javac<span class="regexp">/debug/</span>compileDebugJavaWithJavac<span class="regexp">/classes, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, </span><br><span class="line">	changedFiles={}} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithSecondForDebug</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span></span><br><span class="line"> ImmutableJarInput{</span><br><span class="line"> 	name=:library, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line"> 	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"> 	contentTypes=CLASSES, </span><br><span class="line"> 	scopes=SUB_PROJECTS, </span><br><span class="line"> 	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol"> 	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=a27851442c2ece1ee6b26af1b09d88e2bbc785d0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, </span><br><span class="line">	changedFiles={}} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br></pre></td></tr></table></figure><p>&#x589E;&#x91CF;&#x6784;&#x5EFA;&#x7684;&#x65E5;&#x5FD7;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithFirstForDebug</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=io.github.<span class="string">lizhangqu:</span><span class="string">library:</span><span class="number">1.0</span><span class="number">.0</span>-<span class="string">SNAPSHOT:</span><span class="number">20190628.005304</span><span class="number">-2</span>, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/.gradle/</span>caches<span class="regexp">/transforms-2/</span>files<span class="number">-2.1</span><span class="regexp">/e7d910ca0ea82c5ab31e6f41b3d86629/</span>jars<span class="regexp">/classes.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=EXTERNAL_LIBRARIES, </span><br><span class="line">	status=NOTCHANGED}  </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">no <span class="string">incremental:</span> </span><br><span class="line">ImmutableDirectoryInput{</span><br><span class="line">	name=a27851442c2ece1ee6b26af1b09d88e2bbc785d0, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>javac<span class="regexp">/debug/</span>compileDebugJavaWithJavac<span class="regexp">/classes, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=PROJECT, </span><br><span class="line">	changedFiles={}} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/1 /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span><span class="string">app:</span>transformClassesWithSecondForDebug</span><br><span class="line"></span><br><span class="line">CHANGED input <span class="string">is:</span> </span><br><span class="line">ImmutableJarInput{</span><br><span class="line">	name=io.github.<span class="string">lizhangqu:</span><span class="string">library:</span><span class="number">1.0</span><span class="number">.0</span>-<span class="string">SNAPSHOT:</span><span class="number">20190628.005304</span><span class="number">-2</span>, <span class="comment">//&#x6CE8;&#x610F;name&#x552F;&#x4E00;&#x503C;</span></span><br><span class="line">	file=<span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/first/</span>debug<span class="regexp">/0.jar, /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;</span><br><span class="line">	contentTypes=CLASSES, </span><br><span class="line">	scopes=EXTERNAL_LIBRARIES, </span><br><span class="line">	status=CHANGED} </span><br><span class="line"><span class="symbol">	dest:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/second/</span>debug<span class="regexp">/2.jar /</span>/&#x6CE8;&#x610F;&#x6587;&#x4EF6;&#x540D;&#x662F;<span class="number">2.</span>jar&#x800C;&#x4E0D;&#x662F;<span class="number">0.</span>jar</span><br></pre></td></tr></table></figure><p>&#x7F16;&#x8BD1;&#x62A5;&#x9519;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.<span class="string">RuntimeException:</span> java.lang.<span class="string">RuntimeException:</span> com.android.builder.dexing.<span class="string">DexArchiveMergerException:</span> Error <span class="keyword">while</span> merging dex <span class="string">archives:</span> <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/dexBuilder/</span>debug<span class="regexp">/0, /</span>Users<span class="regexp">/lizhangqu/</span>Desktop<span class="regexp">/android-gradle-plugin-transform-patch/</span>app<span class="regexp">/build/</span>intermediates<span class="regexp">/transforms/</span>dexBuilder<span class="regexp">/debug/</span><span class="number">4.</span>jar, <span class="regexp">/Users/</span>lizhangqu<span class="regexp">/Desktop/</span>android-gradle-plugin-transform-patch<span class="regexp">/app/</span>build<span class="regexp">/intermediates/</span>transforms<span class="regexp">/dexBuilder/</span>debug/<span class="number">2.</span>jar</span><br><span class="line">Learn how to resolve the issue at <span class="string">https:</span><span class="comment">//developer.android.com/studio/build/dependencies#duplicate_classes.</span></span><br><span class="line">Program type already <span class="string">present:</span> &#x67D0;&#x67D0;&#x67D0;&#x7C7B;</span><br></pre></td></tr></table></figure><p>&#x540C;&#x7406;&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x5347;&#x7EA7;aar&#x7684;&#x7248;&#x672C;&#x6216;&#x8005;SNAPSHOT&#x7248;&#x672C;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x5176;getName()&#x8FD4;&#x56DE;&#x7684;maven&#x5750;&#x6807;&#x663E;&#x793A;&#x503C;&#x4E5F;&#x662F;&#x4F1A;&#x8DDF;&#x7740;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x6CE8;&#x610F;SNAPSHOPT&#x7248;&#x672C;&#x5176;getName()&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x540E;&#x4F1A;&#x8DDF;&#x968F;&#x5FEB;&#x7167;&#x7248;&#x672C;&#x7684;&#x65E5;&#x671F;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x540C;&#x7684;SNAPSHOT&#x7248;&#x672C;&#x5176;getName()&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x65E6;&#x5347;&#x7EA7;aar&#x6216;&#x8005;&#x66F4;&#x65B0;SNAPSHOT&#xFF0C;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#x3002;</p><h3 id="&#x5982;&#x4F55;&#x4FEE;&#x590D;"><a href="#&#x5982;&#x4F55;&#x4FEE;&#x590D;" class="headerlink" title="&#x5982;&#x4F55;&#x4FEE;&#x590D;"></a>&#x5982;&#x4F55;&#x4FEE;&#x590D;</h3><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x4EA7;&#x751F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x672C;&#x8D28;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x76F8;&#x540C;&#x7684;&#x7C7B;&#xFF0C;&#x5176;&#x5F52;&#x5C5E;&#x7684;&#x4F9D;&#x8D56;&#x8FD4;&#x56DE;&#x7684;getName()&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x6211;&#x4EEC;&#x5C06;&#x5176;getName()&#x4F20;&#x7ED9;&#x4E86;getContentLocation&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x503C;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x6587;&#x4EF6;&#x540D;&#x8FDB;&#x884C;&#x4E86;&#x9012;&#x589E;&#xFF0C;&#x5339;&#x914D;&#x4E0D;&#x5230;&#x539F;&#x5148;&#x7684;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#xFF0C;&#x5220;&#x9664;&#x4E0D;&#x4E86;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x540C;&#x65F6;&#x53C8;&#x4EA7;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x6587;&#x4EF6;&#xFF0C;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5C06;getContentLocation&#x8FD4;&#x56DE;&#x503C;&#x5339;&#x914D;&#x5230;&#x7684;&#x6587;&#x4EF6;&#x53D8;&#x5F97;&#x548C;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x6837;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</p><p>&#x5BF9;&#x4E8E;FirstTransform&#x6765;&#x8BB2;&#xFF0C;&#x65E0;&#x8BBA;&#x5168;&#x91CF;&#x7F16;&#x8BD1;&#x548C;&#x589E;&#x91CF;&#x7F16;&#x8BD1;&#xFF0C;&#x5176;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&#x90FD;&#x662F;first/0.jar&#x548C;first/1&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x5BF9;&#x4E8E;SecondTransform&#x6765;&#x8BB2;&#xFF0C;__content__.json&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5C06;getName()&#x4F20;&#x9012;&#x7ED9;getContentLocation&#xFF0C;&#x7531;&#x4E8E;getName()&#x8FD4;&#x56DE;&#x4E86;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x4E1C;&#x897F;&#xFF0C;SubStream&#x7F13;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#x5339;&#x914D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6240;&#x4EE5;&#x547D;&#x540D;&#x5FC5;&#x7136;&#x4F1A;&#x8FDB;&#x884C;&#x9012;&#x589E;&#x3002;&#x6240;&#x4EE5;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5C06;getName()&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#xFF0C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x4F20;&#x9012;&#x7ED9;&#x5B83;&#x5373;&#x53EF;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;first/0.jar&#x5C31;&#x4F1A;&#x5BF9;&#x5E94;&#x5230;second/0.jar&#x800C;&#x4E0D;&#x518D;&#x662F;second/2.jar&#x4E0A;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x7528;&#x4E86;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#x65F6;&#xFF0C;&#x5176;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x548C;&#x589E;&#x91CF;&#x6784;&#x5EFA;&#x65F6;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x90FD;&#x662F;first/0.jar&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x53EA;&#x662F;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x524D;&#x540E;&#x4FDD;&#x6301;&#x4E86;&#x552F;&#x4E00;&#x6027;&#xFF0C;&#x7531;&#x4E8E;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x53D6;&#x5230;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x662F;second/0.jar&#x4E86;&#x3002;</p><p>&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;aar&#x5347;&#x7EA7;&#x51FA;&#x73B0;&#x7684;&#x7C7B;&#x91CD;&#x590D;&#x95EE;&#x9898;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5C06;getName()&#x4F20;&#x53C2;&#x4FEE;&#x6539;&#x4E3A;&#x6587;&#x4EF6;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5373;</p><p>&#x5C06;</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getName</span>(), <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.JAR</span>)</span><br><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getName</span>(), <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.DIRECTORY</span>)</span><br></pre></td></tr></table></figure><p>&#x4FEE;&#x6539;&#x4E3A;</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getFile</span>()<span class="selector-class">.toString</span>, <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.JAR</span>)</span><br><span class="line"><span class="selector-tag">transformInvocation</span><span class="selector-class">.getOutputProvider</span>()<span class="selector-class">.getContentLocation</span>(<span class="selector-tag">it</span><span class="selector-class">.getFile</span>()<span class="selector-class">.toString</span>, <span class="selector-tag">it</span><span class="selector-class">.contentTypes</span>, <span class="selector-tag">it</span><span class="selector-class">.scopes</span>, <span class="selector-tag">Format</span><span class="selector-class">.DIRECTORY</span>)</span><br></pre></td></tr></table></figure><p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6709;&#x4EC0;&#x4E48;&#x5F0A;&#x7AEF;&#x5417;&#xFF1F;&#x5F53;&#x7136;&#x6709;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x5DE5;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;n&#x4E2A;transform&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;n&#x4E2A;transform&#x90FD;&#x5F97;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x5426;&#x5219;&#x7167;&#x6837;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x5BF9;&#x4E8E;project&#x5207;&#x6362;&#x6210;aar&#x4F9D;&#x8D56;&#x4E5F;&#x65E0;&#x6548;&#xFF0C;&#x4E5F;&#x7167;&#x6837;&#x4F1A;&#x51FA;&#x73B0;&#x7C7B;&#x91CD;&#x590D;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</p><p>&#x5F53;&#x7136;&#xFF0C;&#x5728;android gradle plugin&#x4E2D;&#xFF0C;&#x5185;&#x7F6E;&#x7684;transform&#x57FA;&#x672C;&#x90FD;&#x5DF2;&#x7ECF;&#x4FEE;&#x6539;&#x6210;&#x4F20;&#x9012;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x4E86;&#x3002;&#x5F88;&#x597D;&#x5947;&#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x4EBA;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x662F;&#x53BB;&#x4FEE;&#x6539;getContentLocation&#x7684;&#x4F20;&#x53C2;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;bug&#x6301;&#x7EED;&#x4E86;&#x4E00;&#x5E74;&#x591A;&#x90FD;&#x6CA1;&#x6709;&#x4FEE;&#x590D;&#x3002;</p><p>&#x90A3;&#x4E48;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x4FEE;&#x590D;&#x5417;&#xFF1F;</p><p>&#x5F53;&#x7136;&#x9700;&#x8981;&#x7528;&#x4E00;&#x70B9;&#x70B9;&#x7684;&#x9ED1;&#x79D1;&#x6280;&#xFF0C;&#x90A3;&#x6BB5;&#x5BFC;&#x81F4;bug&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function">TransformOutputProvider <span class="title">asOutput</span><span class="params">(<span class="keyword">boolean</span> isIncremental)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    <span class="keyword">if</span> (!isIncremental) {</span><br><span class="line">        FileUtils.deleteIfExists(<span class="keyword">new</span> File(getRootLocation(), SubStream.FN_FOLDER_CONTENT));</span><br><span class="line">    }</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TransformOutputProviderImpl(folderUtils);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8BE5;&#x51FD;&#x6570;&#x5B58;&#x5728;IntermediateStream&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#xFF0C;&#x5728;agp 3.2.0&#x53CA;&#x4E4B;&#x540E;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x8BE5;&#x7C7B;&#x90FD;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x8FC7;&#x53D8;&#x5316;&#x3002;</p><p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x8BE5;&#x7C7B;&#x5B9E;&#x73B0;&#x62F7;&#x51FA;&#x6765;&#xFF0C;&#x5C06;&#x5BFC;&#x81F4;bug&#x7684;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x6389;&#xFF0C;&#x5982;&#x4E0B;</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function">TransformOutputProvider <span class="title">asOutput</span><span class="params">(<span class="keyword">boolean</span> isIncremental)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    <span class="comment">//if (!isIncremental) {</span></span><br><span class="line">    <span class="comment">//    FileUtils.deleteIfExists(new File(getRootLocation(), SubStream.FN_FOLDER_CONTENT));</span></span><br><span class="line">    <span class="comment">//}</span></span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TransformOutputProviderImpl(folderUtils);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5355;&#x72EC;&#x5C06;&#x8BE5;&#x7C7B;&#x72EC;&#x7ACB;&#x7F16;&#x8BD1;&#x6210;&#x4E00;&#x4E2A;jar&#x6587;&#x4EF6;&#x3002;</p><p>&#x901A;&#x8FC7;&#x7F16;&#x5199;&#x4E00;&#x4E2A;gradle&#x63D2;&#x4EF6;&#xFF0C;&#x5C06;&#x8BE5;jar&#x6587;&#x4EF6;&#x6CE8;&#x5165;&#x5230;classloader&#x4E2D;&#xFF0C;&#x8BA9;&#x5176;&#x4F18;&#x5148;&#x67E5;&#x627E;&#x6211;&#x4EEC;&#x7684;&#x8865;&#x4E01;jar&#x4E2D;&#x7684;&#x7C7B;&#x5B8C;&#x6210;&#x4FEE;&#x590D;&#xFF0C;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x6709;android hotpatch&#x7684;&#x611F;&#x89C9;&#x3002;</p><p>&#x4E00;&#x5F00;&#x59CB;&#x51C6;&#x5907;&#x91C7;&#x7528;&#x66FF;&#x6362;classloader&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x662F;&#x6D4B;&#x8BD5;&#x8FC7;&#x540E;&#x53D1;&#x73B0;gradle&#x8C8C;&#x4F3C;&#x5BF9;classloader&#x8FDB;&#x884C;&#x4E86;&#x54C8;&#x5E0C;&#x6821;&#x9A8C;&#xFF0C;&#x884C;&#x4E0D;&#x901A;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x80FD;&#x5BF9;&#x5DF2;&#x6709;&#x7684;classloader&#x91C7;&#x53D6;&#x70B9;&#x624B;&#x6BB5;&#x3002;</p><p>gradle&#x4F7F;&#x7528;&#x7684;classloader&#x662F;VisitableURLClassLoader&#xFF0C;&#x5B83;&#x662F;URLClassLoader&#x7684;&#x5B50;&#x7C7B;&#xFF0C;URLClassLoader&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x662F;ucp&#xFF0C;&#x5B83;&#x662F;URLClassPath&#x7C7B;&#x578B;&#xFF0C;&#x8D1F;&#x8D23;&#x7C7B;&#x548C;&#x8D44;&#x6E90;&#x7684;&#x67E5;&#x627E;&#xFF0C;&#x800C;URLClassPath&#x5BF9;&#x8C61;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;loaders&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x5B83;&#x662F;&#x4E2A;ArrayList&#xFF0C;&#x6CDB;&#x578B;&#x662F;URLClassPath.Loader&#xFF0C;&#x67E5;&#x627E;&#x903B;&#x8F91;&#x662F;&#x5728;ArrayList&#x524D;&#x9762;&#x7684;&#x4F1A;&#x8FDB;&#x884C;&#x4F18;&#x5148;&#x67E5;&#x627E;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x8FD9;&#x4E2A;patch&#x6587;&#x4EF6;&#x63D2;&#x5165;&#x5230;&#x8BE5;list&#x6700;&#x524D;&#x9762;&#x5373;&#x53EF;&#xFF0C;&#x5F53;&#x7136;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x8FC7;&#x8BE5;&#x7C7B;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x63D2;&#x5165;&#x4E5F;&#x662F;&#x65E0;&#x6548;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C24;&#x5176;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x8BE5;&#x7C7B;&#x4E4B;&#x524D;&#x88AB;&#x63D0;&#x524D;&#x52A0;&#x8F7D;&#x8FC7;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6D4B;&#x8BD5;&#x524D;&#x5E94;&#x8BE5;&#x5C06;&#x4E4B;&#x524D;&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5168;&#x90E8;&#x6740;&#x6B7B;&#x3002;</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./gradlew</span> <span class="params">--stop</span></span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> * agp transform patch when use agp 3.2.0+</span></span></span><br><span class="line"><span class="comment"><span class="markdown"> */</span></span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AGPTransformPatch</span> </span>{</span><br><span class="line">    public <span class="keyword">static</span> boolean shouldApplyPatch() {</span><br><span class="line">        <span class="built_in">String</span> version = getAndroidGradlePluginVersionCompat();</span><br><span class="line">        <span class="keyword">if</span> (version == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">String</span>[] splitVersions = version.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (splitVersions == <span class="keyword">null</span> || splitVersions.length &lt; <span class="number">3</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">int</span> major = Integer.parseInt(splitVersions[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">int</span> minor = Integer.parseInt(splitVersions[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">//only agp 3.2.0+ need to apply patch</span></span><br><span class="line">        <span class="keyword">if</span> (major &lt; <span class="number">3</span> || (major == <span class="number">3</span> &amp;&amp; minor &lt; <span class="number">2</span>)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> applyAGPTransformPatch(Project project, URL url) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">if</span> (!shouldApplyPatch()) {</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//why not replace classloader ?</span></span><br><span class="line">            <span class="comment">//because there are some problems when replace it.</span></span><br><span class="line">            <span class="comment">//so we add the file to ucp&apos;s loader at first.</span></span><br><span class="line">            ClassLoader originalClassloader = AGPTransformPatch.<span class="keyword">class</span>.getClassLoader();</span><br><span class="line">            Field ucpField = URLClassLoader.<span class="keyword">class</span>.getDeclaredField(<span class="string">&quot;ucp&quot;</span>);</span><br><span class="line">            ucpField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="built_in">Object</span> ucp = ucpField.<span class="keyword">get</span>(originalClassloader);</span><br><span class="line">            Class ucpClass = ucp.getClass();</span><br><span class="line">            Field loadersField = ucpClass.getDeclaredField(<span class="string">&quot;loaders&quot;</span>);</span><br><span class="line">            loadersField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="built_in">List</span>&lt;<span class="built_in">Object</span>&gt; loaders = (<span class="built_in">List</span>&lt;<span class="built_in">Object</span>&gt;) loadersField.<span class="keyword">get</span>(ucp);</span><br><span class="line">            Method getLoaderMethod = ucpClass.getDeclaredMethod(<span class="string">&quot;getLoader&quot;</span>, URL.<span class="keyword">class</span>);</span><br><span class="line">            getLoaderMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="built_in">Object</span> loader = getLoaderMethod.invoke(ucp, url);</span><br><span class="line">            <span class="keyword">if</span> (!loaders.first().getBaseURL().equals(loader.getBaseURL())) {</span><br><span class="line">                loaders.add(<span class="number">0</span>, loader);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                loaders.<span class="keyword">set</span>(<span class="number">0</span>, loader);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GradleException(<span class="string">&quot;Apply agp transform patch failed, please report it.&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">String</span> getAndroidGradlePluginVersionCompat() {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Class versionModel = Class.forName(<span class="string">&quot;com.android.builder.model.Version&quot;</span>);</span><br><span class="line">            Field versionFiled = versionModel.getDeclaredField(<span class="string">&quot;ANDROID_GRADLE_PLUGIN_VERSION&quot;</span>);</span><br><span class="line">            versionFiled.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">String</span>) versionFiled.<span class="keyword">get</span>(<span class="keyword">null</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x8C03;&#x7528;AGPTransformPatch.applyAGPTransformPatch&#x5C06;patch&#x6587;&#x4EF6;&#x7684;URL&#x5BF9;&#x8C61;&#x4F20;&#x5165;&#x5373;&#x53EF;</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (AGPTransformPatch.shouldApplyPatch()) {</span><br><span class="line">    <span class="keyword">File</span> patchFile</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        Dependency dependency = <span class="keyword">project</span>.getDependencies().create(<span class="string">&quot;io.github.lizhangqu:android-gradle-plugin-transform-patch:1.0.0&quot;</span>)</span><br><span class="line">        Configuration configuration = <span class="keyword">project</span>.getConfigurations().detachedConfiguration(dependency)</span><br><span class="line">        configuration.setTransitive(<span class="keyword">false</span>)</span><br><span class="line">        configuration.resolutionStrategy.cacheDynamicVersionsFor(<span class="number">5</span>, <span class="string">&apos;minutes&apos;</span>)</span><br><span class="line">        configuration.resolutionStrategy.cacheChangingModulesFor(<span class="number">0</span>, <span class="string">&apos;seconds&apos;</span>)</span><br><span class="line">        patchFile = configuration.getSingleFile()</span><br><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (patchFile == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">project</span>.logger.error(<span class="string">&quot;can&apos;t get transform patch&apos;s patchFile&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    AGPTransformPatch.applyAGPTransformPatch(<span class="keyword">project</span>, patchFile.toURI().toURL())</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5E94;&#x7528;&#x7F16;&#x5199;&#x597D;&#x7684;gradle&#x63D2;&#x4EF6;&#x5373;&#x53EF;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">&apos;agp-transform-patch&apos;</span></span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x4E0D;&#x751F;&#x6548;&#xFF0C;&#x4E0D;&#x59A8;&#x8BD5;&#x8BD5;&#x5C06;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x6740;&#x6389;&#xFF01;&#xFF01;&#xFF01;</p><h3 id="&#x67F3;&#x6697;&#x82B1;&#x660E;"><a href="#&#x67F3;&#x6697;&#x82B1;&#x660E;" class="headerlink" title="&#x67F3;&#x6697;&#x82B1;&#x660E;"></a>&#x67F3;&#x6697;&#x82B1;&#x660E;</h3><p>&#x6216;&#x8BB8;&#x4F60;&#x89C9;&#x5F97;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x6709;&#x70B9;&#x91CD;&#xFF0C;&#x4E0D;&#x60F3;hook classloader&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x4FEE;&#x590D;&#x65B9;&#x5F0F;&#x5462;&#xFF1F;&#x7231;&#x5947;&#x827A;&#x7684;&#x540C;&#x5B66;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;__content__.json&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#x524D;&#xFF0C;&#x5C06;&#x5176;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x3002;__content__.json&#x662F;&#x5728;asOutput&#x51FD;&#x6570;&#x4E2D;init&#x4E4B;&#x524D;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5982;&#x4E0B;</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">TransformOutputProvider <span class="title">asOutput</span><span class="params">(<span class="keyword">boolean</span> isIncremental)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">    <span class="keyword">if</span> (!isIncremental) {</span><br><span class="line">        FileUtils.deleteIfExists(<span class="keyword">new</span> File(getRootLocation(), SubStream.FN_FOLDER_CONTENT));</span><br><span class="line">    }</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TransformOutputProviderImpl(folderUtils);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;delete&#x524D;&#xFF0C;&#x63D0;&#x524D;&#x8C03;&#x7528;init&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5373;&#x53EF;&#xFF0C;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x65F6;&#x673A;&#x5408;&#x9002;&#x5462;&#xFF1F;&#x5C31;&#x662F;task&#x6267;&#x884C;&#x524D;</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#x901A;&#x8FC7;&#x63D0;&#x524D;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5728;__content__.json&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#x524D;&#x8FDB;&#x884C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x8FBE;&#x5230;&#x4FEE;&#x590D;&#x76EE;&#x7684;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> AGPTransformPatchByPreInitPlugin <span class="keyword">implements</span> Plugin&lt;<span class="keyword">Project</span>&gt; {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">void</span> apply(<span class="keyword">Project</span> <span class="keyword">project</span>) {</span><br><span class="line">        <span class="keyword">if</span> (AGPTransformPatch.shouldApplyPatch()) {</span><br><span class="line">            <span class="keyword">project</span>.gradle.addListener(<span class="keyword">new</span> TaskExecutionListener() {</span><br><span class="line">                @Override</span><br><span class="line">                <span class="keyword">void</span> beforeExecute(<span class="keyword">Task</span> <span class="keyword">task</span>) {</span><br><span class="line">                    <span class="comment">//&#x4E0D;&#x662F;&#x5F53;&#x524D;project&#x4E0D;&#x63D0;&#x524D;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">task</span>.getProject() != <span class="keyword">project</span>) {</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    }</span><br><span class="line">                    <span class="comment">//noinspection GroovyAccessibility</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">task</span> <span class="keyword">instanceof</span> TransformTask &amp;&amp; <span class="keyword">task</span>.outputStream != <span class="keyword">null</span>) {</span><br><span class="line">                        <span class="comment">//noinspection GroovyAccessibility</span></span><br><span class="line">                        <span class="keyword">task</span>.outputStream.init()</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                <span class="keyword">void</span> afterExecute(<span class="keyword">Task</span> <span class="keyword">task</span>, TaskState taskState) {</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">            })</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7B80;&#x5355;&#x7684;&#x51E0;&#x53E5;&#x4EE3;&#x7801;&#x4E5F;&#x53EF;&#x4EE5;&#x8FBE;&#x5230;&#x4FEE;&#x590D;&#x4F5C;&#x7528;&#xFF0C;&#x800C;&#x4E14;&#x6BD4;&#x8F83;&#x8F7B;&#x91CF;&#xFF0C;&#x4EC5;&#x4EC5;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;protected&#x8BBF;&#x95EE;&#x7B26;&#x7684;outputStream&#x7684;init&#x51FD;&#x6570;&#x3002;</p><p>&#x5728;&#x5BF9;&#x5E94;&#x6A21;&#x5757;&#x4E2D;&#x5E94;&#x7528;&#x8BE5;&#x63D2;&#x4EF6;</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">apply</span> plugin: &apos;agp-transform-patch-<span class="built_in">by</span>-pre-init&apos;</span><br></pre></td></tr></table></figure><h3 id="&#x5F00;&#x7BB1;&#x5373;&#x7528;"><a href="#&#x5F00;&#x7BB1;&#x5373;&#x7528;" class="headerlink" title="&#x5F00;&#x7BB1;&#x5373;&#x7528;"></a>&#x5F00;&#x7BB1;&#x5373;&#x7528;</h3><p>&#x8FD9;&#x91CC;&#x6211;&#x5DF2;&#x7ECF;&#x5C06;&#x5176;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;gradle&#x63D2;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;</p><p>&#x5BF9;&#x4E8E;&#x5DE5;&#x7A0B;&#x76EE;&#x5F55;&#x4E2D;&#x6CA1;&#x6709;buildSrc&#x6A21;&#x5757;&#x7684;&#x5DE5;&#x7A0B;&#xFF0C;&#x53EF;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">buildscript</span> {</span><br><span class="line">    <span class="keyword">repositories</span> {</span><br><span class="line">        jcenter()</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">dependencies</span> {</span><br><span class="line">        <span class="keyword">classpath</span>(<span class="string">&apos;io.github.lizhangqu:plugin-agp-transform-patch:1.0.4&apos;</span>)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5728;&#x5BF9;&#x5E94;&#x6A21;&#x5757;&#x4E2D;&#x5E94;&#x7528;&#x63D2;&#x4EF6;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">&apos;agp-transform-patch&apos;</span></span><br></pre></td></tr></table></figure><p>&#x6216;&#x8005;&#x4F7F;&#x7528;&#x63D0;&#x524D;&#x521D;&#x59CB;&#x5316;&#x4FEE;&#x590D;&#x65B9;&#x5F0F;&#x7684;&#x63D2;&#x4EF6;</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">apply</span> plugin: &apos;agp-transform-patch-<span class="built_in">by</span>-pre-init&apos;</span><br></pre></td></tr></table></figure><p>&#x5982;&#x679C;&#x5DE5;&#x7A0B;&#x76EE;&#x5F55;&#x4E2D;&#x6709;buildSrc&#x6A21;&#x5757;&#xFF0C;&#x8BF7;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x5982;&#x4E0A;&#x7684;buildscript&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x4F9D;&#x8D56;&#x6DFB;&#x52A0;&#x5230;buildSrc&#x5DE5;&#x7A0B;&#x7684;&#x4F9D;&#x8D56;&#x4E2D;</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> {</span><br><span class="line">    <span class="keyword">compile</span>(<span class="string">&apos;io.github.lizhangqu:plugin-agp-transform-patch:1.0.4&apos;</span>) {</span><br><span class="line">        changing = <span class="keyword">true</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&quot;com.android.tools.build:gradle:3.2.1&quot;</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7136;&#x540E;&#x5728;&#x5BF9;&#x5E94;&#x6A21;&#x5757;&#x4E2D;&#x5E94;&#x7528;&#x63D2;&#x4EF6;</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">&apos;agp-transform-patch&apos;</span></span><br></pre></td></tr></table></figure><p>&#x6216;&#x8005;&#x4F7F;&#x7528;&#x63D0;&#x524D;&#x521D;&#x59CB;&#x5316;&#x4FEE;&#x590D;&#x65B9;&#x5F0F;&#x7684;&#x63D2;&#x4EF6;</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">apply</span> plugin: &apos;agp-transform-patch-<span class="built_in">by</span>-pre-init&apos;</span><br></pre></td></tr></table></figure><p>&#x91CD;&#x8981;&#x7684;&#x4E8B;&#x60C5;&#x518D;&#x8BF4;&#x4E00;&#x904D;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x751F;&#x6548;&#xFF0C;&#x8BF7;&#x5C06;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x6740;&#x6389;&#xFF0C;&#x56E0;&#x4E3A;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4E2D;&#x8BE5;&#x7C7B;&#x5DF2;&#x7ECF;&#x88AB;&#x52A0;&#x8F7D;&#xFF0C;&#x63D2;&#x5165;patch&#x540E;&#x7531;&#x4E8E;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x539F;&#x6765;&#x7684;&#x7C7B;&#x3002;</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./gradlew</span> <span class="params">--stop</span></span><br></pre></td></tr></table></figure><p>&#x5BF9;&#x5E94;&#x7684;&#x5DE5;&#x7A0B;&#x89C1; <a href="https://github.com/lizhangqu/android-gradle-plugin-transform-patch" target="_blank" rel="noopener">https://github.com/lizhangqu/android-gradle-plugin-transform-patch</a></p></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>赏</span></button><div id="QR" style="display:block"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechat.png" alt="区长 WeChat Pay"><p>微信打赏</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Android/" rel="tag"># Android</a> <a href="/tags/Gradle/" rel="tag"># Gradle</a> <a href="/tags/Transform/" rel="tag"># Transform</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/05/28/R8-踩坑记/" rel="next" title="R8 踩坑记"><i class="fa fa-chevron-left"></i> R8 踩坑记</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/10/20/获取并还原Flutter-Engine-Crash堆栈/" rel="prev" title="获取并还原 Flutter Engine Crash 堆栈">获取并还原 Flutter Engine Crash 堆栈 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="jiathis_style"><a class="jiathis_button_tsina"></a> <a class="jiathis_button_tqq"></a> <a class="jiathis_button_weixin"></a> <a class="jiathis_button_cqq"></a> <a class="jiathis_button_douban"></a> <a class="jiathis_button_renren"></a> <a class="jiathis_button_qzone"></a> <a class="jiathis_button_kaixin001"></a> <a class="jiathis_button_copy"></a> <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a> <a class="jiathis_counter_style"></a></div><script type="text/javascript">var jiathis_config={hideMore:!1}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="区长"><p class="site-author-name" itemprop="name">区长</p><p class="site-description motion-element" itemprop="description">Android Developer</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">50</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">81</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/lizhangqu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="http://www.zhihu.com/people/zhangqu-li" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i> 知乎 </a></span><span class="links-of-author-item"><a href="http://weibo.com/sbsujjbcy" target="_blank" title="微博"><i class="fa fa-fw fa-globe"></i> 微博 </a></span><span class="links-of-author-item"><a href="https://twitter.com/lizhangqu0504" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter </a></span><span class="links-of-author-item"><a href="https://plus.google.com/u/0/114779957383765957041" target="_blank" title="G+"><i class="fa fa-fw fa-globe"></i> G+</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://blog.csdn.net/sbsujjbcy" title="区长的CSDN" target="_blank">区长的CSDN</a></li><li class="links-of-blogroll-item"><a href="https://geminiwen.xyz/" title="geminiwen" target="_blank">geminiwen</a></li><li class="links-of-blogroll-item"><a href="https://www.camnter.com/" title="camnter" target="_blank">camnter</a></li><li class="links-of-blogroll-item"><a href="http://rarnu.xyz/" title="何老师" target="_blank">何老师</a></li><li class="links-of-blogroll-item"><a href="http://dim.red/" title="Dim" target="_blank">Dim</a></li><li class="links-of-blogroll-item"><a href="http://abner-nimengbo.cn/" title="轩辕布" target="_blank">轩辕布</a></li><li class="links-of-blogroll-item"><a href="http://blog.zhaiyifan.cn/" title="mark禽" target="_blank">mark禽</a></li><li class="links-of-blogroll-item"><a href="http://kaedea.com/" title="魔法使kaedea" target="_blank">魔法使kaedea</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#问题描述"><span class="nav-number">1.</span> <span class="nav-text">问题描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transform的增量编译浅析"><span class="nav-number">2.</span> <span class="nav-text">Transform的增量编译浅析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bug再现"><span class="nav-number">3.</span> <span class="nav-text">Bug再现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何修复"><span class="nav-number">4.</span> <span class="nav-text">如何修复</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#柳暗花明"><span class="nav-number">5.</span> <span class="nav-text">柳暗花明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开箱即用"><span class="nav-number">6.</span> <span class="nav-text">开箱即用</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 - <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">区长</span></div><div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info">主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var disqus_shortname="fucknmb-com",disqus_identifier="2019/06/28/治治这个google一年没修的agp-transform-bug/",disqus_title="治治这个 google 一年没修的 agp transform bug";function run_disqus_script(s){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/"+s,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}run_disqus_script("count.js");var disqus_config=function(){this.page.url=disqus_url,this.page.identifier=disqus_identifier,this.page.title=disqus_title};run_disqus_script("embed.js")</script><script type="text/javascript">var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var searchFunc=function(e,c,n){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(c),r=document.getElementById(n);a.addEventListener("input",function(){var u=0,d='<ul class="search-result-list">',f=this.value.trim().toLowerCase().split(/[\s\-]+/);r.innerHTML="",1<this.value.trim().length&&t.forEach(function(e){var a=!1,r=e.title.trim().toLowerCase(),c=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),t=decodeURIComponent(e.url),n=-1,s=-1,o=-1;if(""!=r&&f.forEach(function(e,t){n=r.indexOf(e),s=c.indexOf(e),(0<=n||0<=s)&&(a=!0,0==t&&(o=s))}),a){u+=1,d+="<li><a href='"+t+"' class='search-result-title'>"+r+"</a>";var i=e.content.trim().replace(/<[^>]+>/g,"");if(0<=o){var l=o-20,p=o+80;l<0&&(l=0),0==l&&(p=50),p>i.length&&(p=i.length);var h=i.substring(l,p);f.forEach(function(e){var t=new RegExp(e,"gi");h=h.replace(t,'<b class="search-keyword">'+e+"</b>")}),d+='<p class="search-result">'+h+"...</p>"}d+="</li>"}}),d+="</ul>",0==u&&(d='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==f&&(d='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),r.innerHTML=d}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>